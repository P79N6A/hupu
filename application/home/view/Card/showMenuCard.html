<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>链接一切</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="__HOME_CSS__/add/css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="__HOME_CSS__/add/css/index.css" />
		<link rel="stylesheet" type="text/css" href="__HOME_CSS__/add/css/style.css" />
		<script src="__HOME_CSS__/add/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="__HOME_CSS__/add/js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="__HOME_JS__/whjs/js/hammer.min.js"></script>
		<script src="__HOME_JS__/whjs/js/lrz.all.bundle.js"></script>
		<script src="__HOME_JS__/whjs/js/iscroll-zoom-min.js"></script>
		<script src="__HOME_JS__/whjs/js/PhotoClip.js"></script>

		<style type="text/css">
			body {
				background: #f0eff6;
			}
			
			.in {
				width: 90%;
				margin: 0 auto;
				height: 1rem;
				background: #fff;
				margin-top: 0.3rem;
				line-height: 1rem;
			}
			
			.in span {
				margin-left: 0.3rem;
				color: #4e4b4b;
			}
			
			.in1 input,
			.in2 input {
				width: 2.3rem;
				height: 0.9rem;
				float: right;
				margin-right: 0.2rem;
				border: none;
			}
			
			.in1 input::placeholder,
			.in2 input::placeholder {
				color: #C8C7CC;
				font-size: 0.22rem
			}
			
			.in3 select {
				width: 2rem;
				float: right;
				margin-right: 0.5rem;
				margin-top: 0.3rem;
			}
			
			.in4 {
				height: 5rem;
			}
			
			textarea {
				background: #fff;
				color: #9CA1A6;
				border: 0;
				height: 4rem;
				font-size: 0.16rem;
				margin: 0;
				padding: 0.2rem;
				/*width: 90%;
            margin: 0 auto;*/
			}
			
			.btnbom {
				position: fixed;
				bottom: 0;
				width: 100%;
				height: 50px;
			}
			
			.btnbom input {
				width: 50%;
				float: left;
				text-align: center;
				height: 100%;
				border: none;
			}
			
			.btnbom input:nth-child(1) {
				background: #fff;
				color: #4e4b4b;
			}
			
			.btnbom input:nth-child(2) {
				background: #2FB3D3;
				color: #fff;
			}
			
			.preview {
				width: 31%;
				height: 2rem;
				margin: 0.15rem 0;
			}
			
			.xx {
				width: 0.3rem;
				margin-top: -1.5rem;
				margin-left: -0.4rem;
				margin-right: 0.1rem;
			}
			
			.cover {
				width: 0.5rem;
				margin-left: 50%;
			}
			
			.big_box {
				width: 100%;
				height: 100%;
				position: fixed;
				top: 0rem;
				z-index: 2;
				background: rgba(0, 0, 0, 0.5);
				display: none;
			}
			
			body {
				margin: 0;
			}
			
			#clipArea {
				height: 85%;
			}
			
			#file {
				margin: 20px;
			}
			
			input {
				-webkit-appearance: none;
				border-radius: 0;
			}
			
			.clip {
				background-color: #000;
				display: none;
				width: 100%;
				height: 100%;
				position: fixed;
				top: 0;
				z-index: 10000;
			}
			
			.photo-clip-view {
				background-color: #fff;
			}
			
			.btun {
				width: 274px;
				height: 10%;
				margin: 0 auto;
			}
			
			#clipBtn {
				width: 35%;
				height: 40px;
				line-height: 40px;
				background-color: #2FB3D3;
				color: #fff;
				text-align: center;
				border: none;
				position: relative;
				z-index: 999;
			}
			
			#cancel {
				background-color: #fff;
				color: #000;
				width: 35%;
				height: 40px;
				line-height: 40px;
				border-radius: 5px;
				border: none;
				margin-right: 26%;
				position: relative;
				z-index: 999;
			}
			
			.gif {
				position: fixed;
				top: 0;
				left: 0;
				z-index: 1000000;
				width: 100%;
				height: 100%;
				text-align: center;
				display: none;
			}
			
			.gif>img {
				position: absolute;
				top: 32%;
				left: 34%;
			}
		</style>
		<script type="text/javascript">
			mui.init();
		</script>
	</head>

	<body ontouchstart="">

		<div class="clip">
			<div class="gif">
				<img src="__HOME_IMAGES__/new_load.gif" alt="" />
			</div>
			<div id="clipArea"></div>
			<div class="btun">
				<button id="cancel" style="padding:0">取消</button>
				<button id="clipBtn" style="padding:0">截取</button>
			</div>
		</div>
		<form action="" id="form" method="post" enctype="multipart/form-data">
			<div class="big_box"></div>

			<input type="hidden" name="id" value="{$Think.get.id}">
			<div class="in in1">
				<span>标题</span>
				<input type="text" name="name" style="text-align: right;width: 70%" value="{$data.name}" placeholder="请在此输入" />
			</div>
			<div class="in in2">
				<span>封面</span>
				<if condition="$data.icon_url eq null">
					<img src="__HOME_IMAGES__/h_icon_2_on.png" class="cover" id="cover_img" alt="">
					<else/>
					<img src="{$data.icon_url}" class="cover" id="cover_img" alt="">
				</if>
				<input type="file" id="file" class="cover_file" style="display: none">
				<input type="hidden" name="icon_url" id="cover_input" value="{$data.icon_url}" />

			</div>
			<div class="in in2">
				<span>排序设置</span>
				<input type="text" name="sort" style="text-align: right" value="{$data.sort}" placeholder="数字越小越靠前" />
			</div>
			<div class="in in4">
				<span>跳转地址</span>
				<textarea class="link_con" name="jump_url" placeholder="请输入网址并在前面加上http://" style="font-size:18px; color: #000000;">{$data.jump_url}</textarea>
			</div>

		</form>

		<div class="btnbom">
			<input type="button" onclick="back();" name="" id="" value="取消" />
			<input type="button" onclick="submit();" name="" id="" value="保存" />
		</div>

		<script>

			var search = location.search;
			console.log(search)
			function getCaption(obj){
					var index=obj.lastIndexOf("\/");
					obj=obj.substring(index+1,obj.length);
				//  console.log(obj);
					return obj;
				}
				var judge = getCaption(search);
				if(judge == 'showMenuCard.html'){
					$('.link_con').text('http://')
				}

			var clipArea =  new PhotoClip("#clipArea", {
				size: [262, 184],
				outputSize: [640, 640],
				file: "#file",
				ok: "#clipBtn",
				loadStart: function() {
					$('.gif').show();
				},
				loadComplete: function() {
					$('.gif').hide();
				},
				done: function(dataURL) {
				var imgsize = document.getElementById('file').files[0].size;
				if(imgsize > 1024*1024*10){
					mui.toast("请上传小于10M的图片");
					return false;
					}else{
						var img = document.getElementById("cover_img");
						//图片路径设置为读取的图片
						img.src = dataURL;
						$('#cover_input').attr('value', img.src);
					}
				
				}
			});
			$("#cancel,#clipBtn").click(function() {
				$(".clip").hide();
			})

		</script>

		<script>
			var checkSubmitFlg = 1;

			function back() {
				mui.confirm("正在编写状态，是否要返回？", "", ["否", "是"], function(res) {
					if(res.index == 1) {
						top.location.href = "/index.php?s=/Home/Card/menuCard";
					}
				});
			}

			$('.cover').click(function() {
				$('.cover_file').click();
				$(".clip").show();
			});

			function submit() {
				var title = $('input[name=name]').val();
				var icon_url = $('input[name=icon_url]').val();
				if(title.length <= 0) {
					mui.toast("请填写标题");
					return;
				}
				if(icon_url.length <= 0) {
					mui.toast("请上传封面");
					return;
				}
				if(checkSubmitFlg == 1) {
					$("#form").submit();
					checkSubmitFlg = 0;
				} else {
					mui.toast("请勿重复提交");
				}

			}

		</script>

		<script src="__HOME_CSS__/add/js/index.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
		<script type="text/javascript">
			document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
				// 通过下面这个API隐藏右上角按钮hideOptionMenu
				WeixinJSBridge.call('hideOptionMenu');
			});
		</script>
	</body>

</html>
