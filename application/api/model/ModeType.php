<?php//团队表 数据层namespace app\api\model;use think\Db;use think\Model;class ModeType extends Model{    protected $table = 's_mode_type';    //添加或修改    public function add_mode_type($title,$user_id,$type,$sort=0,$type_id=0)    {        $data = array(          'title'=>$title        );        if($type_id == 0){            $mode_id = $this->where(array('user_id'=>$user_id,'type'=>$type))->max('mode_id');            //添加            $data['user_id'] = $user_id;            $data['sort'] = $sort;            $data['mode_id'] = $mode_id+1;//添加            $data['type'] = $type;            $data['addtime'] = date('Y-m-d H:i:s');            $res = $this->insert($data);        }else{            //修改            $res = $this->where(array('mode_id'=>$type_id,'type'=>$type,'user_id'=>$user_id))->update($data);        }        return $res;    }    //列表    public function mode_type_list($user_id,$type)    {        $res = $this->field('mode_id as id,title,sort')->where(array('user_id'=>$user_id,'type'=>$type))->order('sort asc')->select();        return $res;    }    //修改排序    public function mode_type_sort($user_id,$content,$type)    {        $arr_content = explode(',',$content);        if($arr_content){            foreach($arr_content as $v){                $new_arr = explode('=',$v);                Db::table('s_mode_type')->where(array('user_id'=>$user_id,'mode_id'=>$new_arr[0],'type'=>$type))->update(array('sort'=>$new_arr[1]));            }            return true;        }else{            return false;        }    }    //删除(批量)    public function mode_type_del($type_ids,$user_id,$type)    {        $ids = explode(',',$type_ids);        if($ids){            $result = false;            $id_arr = array();            foreach ($ids as $id){                $res = Db::table('s_mode_type')->where(array('mode_id'=>$id,'user_id'=>$user_id,'type'=>$type))->find();                if($res){                    $id_arr[] = $id;                }            }            if($id_arr){                $result = Db::table('s_mode_type')->where(array('user_id'=>$user_id,'mode_id'=>array('in',$id_arr),'type'=>$type))->delete();                if($type == 0){                    Db::table('s_users_nav')->where(array('user_id'=>$user_id,'type_id'=>array('in',$id_arr)))->delete();                }elseif($type == 1){                    Db::table('s_user_video')->where(array('user_id'=>$user_id,'type_id'=>array('in',$id_arr)))->delete();                }elseif($type == 2){                    $s_id =  Db::table('s_card_content')->field('id')->where(array('user_id'=>$user_id,'type_id'=>array('in',$id_arr)))->select();                    if($s_id){                        $del_id = array();                        foreach ($s_id as $v){                            $del_id[] = $v['id'];                        }                        Db::table('s_card_content_res')->where(array('card_content_id'=>array('in',$del_id)))->delete();                    }                    Db::table('s_card_content')->where(array('user_id'=>$user_id,'type_id'=>array('in',$id_arr)))->delete();                }else{                    $p_id = Db::table('s_product')->field('id')->where(array('user_id'=>$user_id,'new_type'=>array('in',$id_arr)))->select();                    if($p_id){                        $del_ids = array();                        foreach ($p_id as $v){                            $del_ids[] = $v['id'];                        }                        Db::table('s_product_detail')->where(array('product_id'=>array('in',$del_ids)))->delete();                        Db::table('s_product_img')->where(array('product_id'=>array('in',$del_ids)))->delete();                    }                    Db::table('s_product')->where(array('user_id'=>$user_id,'new_type'=>array('in',$id_arr)))->delete();                }            }            if($result){                return true;            }else{                return false;            }        }else{            return false;        }    }}