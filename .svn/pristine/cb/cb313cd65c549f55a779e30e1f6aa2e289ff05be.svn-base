<?php/** * Created by PhpStorm. * User: admin * Date: 2017/12/7 * Time: 0:16 */namespace app\api\controller;use app\common\controller\ApiBase;class Message extends  ApiBase{    public function MyFriends()    {        $where = $this->request;        $where['user_id'] = $this->userInfo['id'];        $list = D("Api/Cards",'Logic')->getCards($where);        if(!empty($list))        {            $this->array_return['ResultType']=self::__OK__;            $this->array_return['Message']="获取网夹列表成功";            $this->array_return['AppendData']=$list;        }else{            $this->array_return['ResultType']=self::__ERROR__;            $this->array_return['Message']="获取网夹列表失败";            $this->array_return['AppendData']=null;        }        return json($this->array_return);    }    public function DeleteMyFriends()    {        $where = $this->request;        if(!isset($this->_reqparam['id']))        {            $this->array_return['ResultType']=self::__ERROR__;            $this->array_return['Message']="没有选择要删除的朋友！";            return json($this->array_return);        }else{            $where['id']=$this->_reqparam['id'];        }        //TODO:删除朋友时没有加userid条件，删除朋友条件中除了要有ID，还应该有user_id        $result =D("Api/Cards",'Logic')->delCards($where);        if(!empty($result))        {            $this->array_return['ResultType']=self::__OK__;            $this->array_return['Message']="删除朋友成功";            $this->array_return['AppendData']=$result;        }else{            $this->array_return['ResultType']=self::__ERROR__;            $this->array_return['Message']="删除朋友失败";            $this->array_return['AppendData']=null;        }        return json($this->array_return);    }    public function ViewMyFriend()    {        $where = $this->request;        if(!isset($this->_reqparam['id']))        {            $this->array_return['ResultType']=self::__ERROR__;            $this->array_return['Message']="没有选择要查看的朋友！";            return json($this->array_return);        }else{            $where['id']=$this->_reqparam['id'];        }        //TODO:删除朋友时没有加userid条件，查看朋友条件中除了要有ID，还应该有user_id        $result =D("Api/Cards",'Logic')->getCardsInfo($where);        if(!empty($result))        {            $this->array_return['ResultType']=self::__OK__;            $this->array_return['Message']="查看朋友成功";            $this->array_return['AppendData']=$result;        }else{            $this->array_return['ResultType']=self::__ERROR__;            $this->array_return['Message']="获取朋友资料失败";            $this->array_return['AppendData']=null;        }                return json($this->array_return);    }    public function AddTrading()    {        $data=array();        $data['user_id']=$this->userInfo['id'];        if(!isset($this->_reqparam['tradId']))        {            $this->array_return['ResultType']=self::__ERROR__;            $this->array_return['Message']="没有选择要交换V网的朋友！";            return json($this->array_return);        }else{            $object_user=D("Api/User",'Logic')->getUserInfoOption(array('spopenid'=>$this->_reqparam['spopenid']));            if(empty($object_user))            {                $this->array_return['ResultType']=self::__ERROR__;                $this->array_return['Message']="要交换V网的朋友的资料没有找到！";                return json($this->array_return);            }            $data['object_id']=$object_user['id'];        }        if(!isset($this->_reqparam['notice']))        {            $this->array_return['ResultType']=self::__ERROR__;            $this->array_return['Message']="交朋友总得说点什么吧！";            return json($this->array_return);        }else{            $data['msg']=$this->_reqparam['notice'];        }        $result=D('Api/Cards','Logic')->applyCards($data);        if($result){            $this->array_return['Message']="交换微网申请成功";            $visit_id=$this->_reqparam['visit_id'];            if($visit_id){//通过分享                $result=D('Api/Cards','Logic')->addCollection($this->userInfo['id'],$this->_reqparam['tradId'],$visit_id);                if($result)                {                    $this->array_return['Message'].='加入收藏成功！';                    $this->array_return['ResultType']=self::__OK__;                }else{                    $this->array_return['Message'].='加入收藏失败！';                    $this->array_return['ResultType']=self::__OK__;                }            }else{//通过加好友                $this->array_return['Message'].='交换微网申请成功!！';                $this->array_return['ResultType']=self::__OK__;            }        }else{            return json(array('status'=>0,'msg'=>'请勿重复申请'));            $this->array_return['ResultType']=self::__ERROR___;        }                return json($this->array_return);    }}