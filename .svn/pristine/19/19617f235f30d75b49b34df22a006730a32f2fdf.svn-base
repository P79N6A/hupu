<?phpnamespace app\api\controller;use Think\Controller;use think\Db;/** * Class SquareApiController * @package Api\Controller * 小秘广场接口 */class SquareApi extends Controller{    const __OK__ = '0'; //请求成功    const __ERROR__ = '1'; //参数错误    const __ERROR1__ = '2'; //没有绑定    const __ERROR2__ = '3';//数据库错误    private $array_return=array("ResultType"=>1,"Message"=>"success","AppendData"=>[]);    private  $_reqparam;    private  $userInfo;        /**     * 轮播图     */    public function banner_img()    {        $res = Db::table('s_search_img')->where('type=2')->order('sort asc')->select();        if ($res) {            $this->array_return['ResultType'] = self::__OK__;            $this->array_return['Message'] = "操作成功";            $this->array_return['AppendData'] = $res;        } else {            $this->array_return['ResultType'] = self::__ERROR2__;            $this->array_return['Message'] = "操作失败";        }                return json($this->array_return);    }        /**     * 文章列表     */    public function article_list()    {        $type =  $this->_reqparam['type'];//1:热门   2：最新  3：推荐        $types = $this->_reqparam['types'];//1:首页取4条   2：获取全部        $start = $this->_reqparam['start']?$this->_reqparam['start']:0;//从第几条取        $length = $this->_reqparam['length']?$this->_reqparam['length']:99;//一次取几条        $where['status'] = 1;        if($types == 1){            $length = 4;        }        if($type == 1){            $order = 'visit desc';        }elseif ($type == 3){            $where['type_id'] = 17;//新闻大事件            $order = 'id desc';        }else{            $order = 'id desc';        }        $res = Db::table('s_system_article')->where($where)->order($order)->limit($start,$length)->select();        if ($res) {            foreach ($res as &$v){                $v['content'] = mb_substr(cutstr_html($v['content']),0,20,'utf-8').'...';                $v['addtime'] = date('m-d H:i',$v['addtime']);            }            $this->array_return['ResultType'] = self::__OK__;            $this->array_return['Message'] = "操作成功";            $this->array_return['AppendData'] = $res;        } else {            $this->array_return['ResultType'] = self::__ERROR2__;            $this->array_return['Message'] = "操作失败";        }                return json($this->array_return);    }        /**     * 视频列表     */    public function video_list()    {        $type = $this->_reqparam['type'];//1:首页取三条   2：获取全部        $start = $this->_reqparam['start']?$this->_reqparam['start']:0;//从第几条取        $length = $this->_reqparam['length']?$this->_reqparam['length']:99;//一次取几条        if($type == 1){            $length = 3;        }        $res = Db::table('s_user_video')->field('id,title,video,video_cover')->order('visit desc')->limit($start,$length)->select();        if ($res) {            $this->array_return['ResultType'] = self::__OK__;            $this->array_return['Message'] = "操作成功";            $this->array_return['AppendData'] = $res;        } else {            $this->array_return['ResultType'] = self::__ERROR2__;            $this->array_return['Message'] = "操作失败";        }                return json($this->array_return);    }        /**     * 产品列表     */    public function product_list()    {        $type = $this->_reqparam['type'];//1:首页取三条   2：获取全部        $start = $this->_reqparam['start']?$this->_reqparam['start']:0;//从第几条取        $length = $this->_reqparam['length']?$this->_reqparam['length']:99;//一次取几条        if($type == 1){            $length = 4;        }        $res = Db::table('s_product')->alias('p')            ->join('left join s_user_info u on u.id = p.user_id')            ->field('p.id,p.title,p.cover_img,p.describe,u.unionid')            ->order('p.visit desc')            ->limit($start,$length)->select();        if ($res) {            $this->array_return['ResultType'] = self::__OK__;            $this->array_return['Message'] = "操作成功";            $this->array_return['AppendData'] = $res;        } else {            $this->array_return['ResultType'] = self::__ERROR2__;            $this->array_return['Message'] = "操作失败";        }                return json($this->array_return);    }    }