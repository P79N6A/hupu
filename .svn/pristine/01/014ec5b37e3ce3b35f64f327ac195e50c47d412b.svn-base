<?phpnamespace app\common\controller;use think\Cache;use think\Controller;use think\Db;/** * Api 基类控制器 */class ApiBase  extends Controller{	    /**     * 初始化方法     */    const __OK__ = '0'; //请求成功    const __ERROR__ = '1'; //参数错误    const __ERROR1__ = '2'; //没有绑定    const __ERROR2__ = '3';//数据库错误    const __ERROR4__ = '4';//未查询到数据    const __ERROR5__ = '5';//条件不符合    public $code_expire_time = 60;//验证码过期时间    public $array_return = array("ResultType"=>1,"Message"=>"success","AppendData"=>[]);    public  $request;    public  $userInfo;    public function _initialize()    {        if($_SERVER['REQUEST_METHOD']=='PUT')        {            $input = json_decode(file_get_contents('php://input'));            if ($input) {                $this->request = $this->object_array($input);            }        } else {            $this->request = Request::param();        }        $user_info = session("user_info");        $this->userInfo = $user_info;        $action_name = strtolower(ACTION_NAME);        $controller_name = strtolower(CONTROLLER_NAME);        if(in_array($action_name,C('NO_APP_LOGIN')[$controller_name])) {    		return ;	    }	            if ($this->request['unionid'] || $this->request['spopenid'])         {        	$this->array_return['ResultType'] = self::__ERROR__;            $this->array_return['Message'] = "非法访问";            $this->array_return['data'] = null;            return json($this->array_return);        }                    if (!$this->userInfo) {        	$uid = Db::table('s_member')->where(array('unionid' => $this->request['unionid']))->value('id');         	$this->userInfo = Db::table('s_user_info')->field('user_id,headimg,nick_name')->where(array('user_id'=>$uid))->find();            } else {            $this->request['userInfo'] = $this->userInfo;        }    }    public function checklogin($uid, $token)    {        $where = array();        $where['id'] = array('EQ', $uid);        $res = Db::table('s_userInfo')->where($where)->find();        if ($res['token'] != $token) {            Util::response('1009', '请重新登录', null);            exit();        } else {            unset($res['passwd']);            return $res;        }    }    /**     * 前段用户注销     */    public function logQianOut()    {        // 清楚所有session        session(null);        echo json_encode('注销成功');    }    /**     * 对象转数组     */    public function object_array($array)     {        if(is_object($array)) {            $array = (array)$array;        }        if(is_array($array)) {            foreach($array as $key=>$value) {                $array[$key] = $this->object_array($value);            }        }        return $array;    }}