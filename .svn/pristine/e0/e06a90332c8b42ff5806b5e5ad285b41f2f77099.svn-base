<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>添加收货地址</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="__HOME_CSS__/add/css/mui.min.css" />
    <script src="__HOME_CSS__/add/js/jquery-3.1.0.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="__HOME_CSS__/add/js/mui.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="__HOME_JS__/whjs/js/template-web.js"></script>

    <style type="text/css">
        body {
            background: #fff;
        }

        .in {
            width: 90%;
            margin: 0 auto;
            height: 1rem;
            background: #fff;
            margin-top: 0.3rem;
            line-height: 1rem;
            border-bottom: 1px solid #eee;
        }

        .in span {
            width: 30%;
            height: 1rem;
            display: block;
            color: #4e4b4b;
            font-size: 0.25rem;
            
        }

        .inn span {
            width: 30%;
            display: block;
            color: #4e4b4b;
            font-size: 0.25rem;
        }

        .in2 span {
           width: 20%;
           height: 1rem;
            color: #909389;
        }

        .in1 input {
            width: 70%;
            height: 0.8rem;
            float: right;
            margin-top: 0.1rem;
            border: none;
            background: #fff;
            color: #999;
            margin-bottom: 0;
            box-sizing: border-box;

        }

        .in2 span:nth-child(2) {
            float: right;
            margin-right: 0.5rem;
        }

        .in1 input::placeholder,
        .in2 input::placeholder {
            color: #C8C7CC;
            font-size: 0.22rem
        }

        .zzc_myruanwen_from_input span {
            float: left;
        }

        .zzc_myruanwen_from_input {
            margin: 10px auto;
            background: #FAFAFA;
            position: relative;
            width: 90%;
            height: 60px;
            line-height: 60px;
            overflow: hidden;
        }

        .zzc_myruanwen_from_input span {
            float: left;
        }

        .sel {
            width: 80%;
            height: 100%;
        }

        .select {
            font-size: 14px;
            height: auto;
            margin-top: 1px;
            border: 0 !important;
            background-color: #8a6de9;
            width: 75%;
        }

        .myguanggao_bottom>input {
            background: #2FB3D3;
            height: 60px;
            width: 100%;
            border: none;
            color: #FFFFFF;
            text-align: center;
        }

        .myguanggao_bottom {
            height: 60px;
            width: 100%;
            position: fixed;
            bottom: 0px;
            left: 0;
        }

        .sele {
            width: 75%;
            height: 100%;
            background-color: #FAFAFA;
            font-size: 17px;
            background: url(__HOME_IMAGES__/inco_fenlei_grey.png) no-repeat 90% 25px;
            background-size: 6% 15%;
            margin-bottom: 0;
            padding: 0;
        }

        .inn {
            width: 90%;
            margin: 0 auto;
            height: 2rem;
            background: #fff;
            margin-top: 0.3rem;
            line-height: 1rem;
            box-sizing: border-box;
        }

        .default {
            width: 90%;
            background-color: #fff;
            margin: 0 auto;
            margin-top: 0.3rem;
            height: 0.75rem;

        }

        .mui-switch {
            margin-top: 0.16rem;
            margin-right: 0.25rem;
        }

        .default_dress {
            height: 100%;
            line-height: 0.75rem;
            margin-left: 0.3rem;
        }


        .clearfix:after {
            clear: both;
            content: ' ';
            display: block;
        }

        .fl {
            float: left !important;
        }

        .fr {
            float: right;

        }

        .dress_box {
            width: 90%;
            margin: 0 auto;
            height: 1rem;
            background: #fff;
            margin-top: 0.3rem;
            line-height: 1rem;
            border-bottom: 1px solid #eee;
        }

        .dress_box span{
            width: 25%;
            height: 100%;
            display: block;
            font-size: 0.25rem;
        }

        .dress_box #city_one,#city_two{
            width: 28%;
            margin-left: 0.5rem;
            height: 97%;
            padding: 0 0 ;
            font-size: 0.25rem;

        }

         #city_one,#city_two{
             color: #999;
         }

        .content {
            width: 90%;
            height: 100%;
            margin: 0 auto;
            box-shadow: 2px 4px 8px 0px rgba(0, 0, 0, 0.15);
            border-radius: 10px;
        }
    </style>
    <script type="text/javascript">
        mui.init();
    </script>

</head>

<body>
    <div class="content">
        <div class="in in1">
            <span class="fl">收货人</span>
            <input type="text" name="" class="zzc_mingpfuzhi_input fl" id="username" value="" placeholder="请填写收货人">
        </div>
        <div class="in in1">
            <span class="fl">联系手机</span>
            <input type="number" name="" class="zzc_mingpfuzhi_input fl" id="usernum" value="" placeholder="请填写手机号码">
        </div>

        <div class="dress_box in1">
            <span class="fl">所在地址</span>
            <!-- <input type="text" placeholder="请输入所在地址的省市" id="userdress" value=""> -->
            <select class="city fl" id="city_one">

            </select>

            <select class="city fl" id="city_two">

            </select>



        </div>

        <div class="inn in1">
            <span class="fl">详细地址</span>
            <input type="text" class="zzc_mingpfuzhi_input fl" id="keyword" value="" placeholder="请输入所在地的详细地址">
        </div>


        <div class="myguanggao_bottom">
            <input type="submit" name="" id="submit" value="保存" />
        </div>
    </div>

    <script src="__HOME_CSS__/add/js/index.js" type="text/javascript" charset="utf-8"></script>
</body>

</html>

<script type="text/html" id="city">
    <option value="">请选择省市</option>
    {{each AppendData v i }}
    <option data-id="{{v.region_id}}" value="{{v.region_id}}">{{v.region_name}}</option>
    {{/each }}
</script>

<script type="text/html" id="city_">
    <option value="">请选择区域</option>
    {{each AppendData v i}}
    <option data-id="{{v.region_id}}" value="{{v.region_id}}">{{v.region_name}}</option>
    {{/each}}

</script>
<script>
    $(function () {
        var id = '{$id}';
        var city_onename;
        var one_id = '';

        var city_twoname;
        var two_id = '';
        console.log(id)
        var losearch = location.search;
        console.log(losearch)

        function getCaption(obj) {
            var index = obj.lastIndexOf("/");
            obj = obj.substring(index + 1, obj.length);
            //  console.log(obj);
            return obj;
        }
        losearch = getCaption(losearch);
        console.log(losearch)


        //一级城市
        $.ajax({
            type: "post",
            url: "index.php?s=/Api/IndexApi/region_list",
            data: {
                unionid: id,
            },
            success: function (res) {
                console.log(res)
                $("#city_one").html(template("city", res));
                $("#city_one").on("change", function () {
                    city_onename = $("#city_one").find("option:selected").text();
                    one_id = $("#city_one option:selected").val();

                    //二级城市
                    $.ajax({
                        type: "post",
                        url: "index.php?s=/Api/IndexApi/region_list",
                        data: {
                            unionid: id,
                            region_id: one_id
                        },
                        success: function (res) {
                            console.log(res);
                            $("#city_two").html(template("city_", res));
                            $("#city_two").on("change", function () {

                                city_twoname = $("#city_two").find(
                                    "option:selected").text();
                                two_id = $("#city_two option:selected")
                                    .val();

                            })


                        }
                    })


                })

            }
        });









        $("#submit").on("click", function () {

            var user = $("#username").val();
            var usermobile = $("#usernum").val();
            var detaildress = $("#keyword").val();
            var check = $(".mui-switch");
            var ischeck = 0;




            console.log(one_id);
            console.log(two_id);


            // console.log(ischeck+"外边的");
            if (check.hasClass("mui-active")) {
                ischeck = 1;
                // console.log(ischeck+"里面的");
            } else {
                ischeck = 0;
            }


            // console.log(user+"用户名")
            // console.log(usermobile+"手机号")
            // console.log(userdress+"省市")
            // console.log(detaildress+"详细地址");

            if (user == '') {
                mui.toast("请输入收货人姓名");
                return false;
            } else if (one_id == '' || two_id == '') {
                mui.toast("请选择所在地址的省市,及区域");
                return false;
            } else if (detaildress == '') {
                mui.toast("请输入所在地的详细地址");
                return false;
            }



            $.ajax({
                url: "index.php?s=/Api/LuckApi/add_address",
                type: "post",
                data: {
                    unionid: id,
                    name: user,
                    tel: usermobile,
                    detail_add: detaildress,
                    province_id: one_id,
                    city_id: two_id,
                    is_true: ischeck
                },
                success: function (res) {
                    console.log(res);
                    mui.toast("保存成功");
                    window.location.href = "/index.php?s=/Home/lottery/addgoods/p/" +
                        losearch + "";
                }


            })


        });




    });
</script>