<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" href="/Public/Home/css/wh/base.css">
    <script src="/Public/Home/js/whjs/js/jquery-1.8.3.min.js"></script>
    <script src="/Public/Home/js/whjs/js/newrem.js"></script>
    <title>排行榜</title>
    <style>
        body,
        html {
            background: linear-gradient(180deg, rgba(77, 205, 253, 1) 0%, rgba(38, 158, 249, 1) 100%);
            /* height: 100%; */
            background-repeat: no-repeat;


        }

        .header {
            width: 100%;
            position: relative;

        }

        .header ul {
            width: 100%;
            height: 100%;
            padding-top: .5rem;
        }

        .header ul li {
            width: 33.33%;
            height: 100%;
            text-align: center;
        }

        .header ul li .use_imgbox {
            width: .77rem;
            height: .77rem;
            border-radius: 50%;
            margin: 0 auto;
            position: relative;
        }

        .header ul li .use_imgbox .user_img {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 50%;
            margin-top: .278rem;
        }

        .header ul li .use_imgbox .crown {
            position: absolute;
            width: .25rem;
            height: .25rem;
            top: -.11rem;
            left: 0;
        }

        .header ul li .use_imgbox .rank {
            width: .44rem;
            height: .17rem;
            line-height: .17rem;
            font-size: .12rem;
            color: #fff;
            text-align: center;
            border: 1px solid #fff;
            background: #ccc;
            border-radius: .75rem;
            position: absolute;
            bottom: 0;
            left: 50%;
            margin-left: -.22rem;
            margin-bottom: -0.05rem;
        }

        .header ul li .frist_use_imgbox {
            width: 1.06rem;
            height: 1.06rem;
            border-radius: 50%;
            margin: 0 auto;
            position: relative;
        }

        .header ul li .frist_use_imgbox .frist_user_img {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 50%;

        }

        .header ul li .frist_use_imgbox .crown {
            position: absolute;
            width: .33rem;
            height: .32rem;
            display: block;
            top: -.14rem;
            left: 0;
        }

        .header ul li .frist_use_imgbox .rank {
            width: .56rem;
            height: .22rem;
            line-height: .22rem;
            color: #fff;
            text-align: center;
            border: 1px solid #fff;
            background: #ccc;
            border-radius: .75rem;
            position: absolute;
            bottom: 0;
            left: 50%;
            margin-left: -.28rem;
            margin-bottom: -0.05rem;
            font-size: .13rem;
            background: #F9C400;
        }

        .header ul li .user_name {
            color: #fff;
            width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: .05rem .05rem;
            box-sizing: border-box;
        }

        .header ul li .throw_count {
            color: #fff;
            padding-bottom: .12rem;
        }

        .header ul li .btn {
            width: .8rem;
            height: .32rem;
            border-radius: .18rem;
            color: #fff;
            text-align: center;
            line-height: .32rem;
            border: 1px solid #fff;
            outline: none;
            background: rgba(77, 205, 253, 0.8);
            font-size: .14rem;

        }

        .main {
            width: 100%;
            margin-top: .23rem;
        }

        .main .list {
            width: 3.59rem;
            height: 1.02rem;
            background: #fff;
            border-radius: .08rem;
            margin: 0 auto;
            box-shadow: 0px 3px 7px 0px rgba(62, 142, 201, 0.31);
            margin-bottom: .09rem;
        }

        .main .list .fl:nth-child(1) {
            width: 30%;
            height: 100%;
            position: relative;
        }

        .main .list .fl:nth-child(1) .use {
            width: .78rem;
            height: .78rem;
            margin: .12rem auto;
            display: block;
            border-radius: 50%;
        }

        .main .list .fl:nth-child(1) p {
            position: absolute;
            bottom: 0;
            margin-bottom: 0.09rem;
            left: 50%;
            margin-left: -0.225rem;
            width: .45rem;
            height: .18rem;
            line-height: .18rem;
            text-align: center;
            color: #fff;
            background: #A4DAFF;
            border-radius: .12rem;
            font-size: .12rem;
            box-shadow: 0px 3px 7px 0px rgba(62, 142, 201, 0.31)
        }

        .main .list .fl:nth-child(2) {
            width: 40%;
            height: 100%;
        }

        .main .list .fl:nth-child(2) .user {
            font-size: .18rem;
            font-weight: bold;
            padding-top: .24rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .main .list .fl:nth-child(2) .throw_c {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-bottom: .05rem;
        }

        .main .list .fl:nth-child(2) .bottom_bg {
            width: 100%;
            height: .05rem;
            background: url(/Public/Home/images/back_c.png) left center no-repeat;
            border-radius: .02rem;
        }

        .main .list .fl:nth-child(2) .bottom_bg .top_bg {
            background: url(/Public/Home/images/back_b.png) right center repeat-x;
            height: 100%;
            width: 0;
        }

        .main .list .fl:nth-child(3) {
            width: 30%;
            height: 100%;
            position: relative;
        }

        .main .list .fl:nth-child(3) .throw_btn {
            width: 100%;
            height: 100%;
            color: #fff;
            border-radius: .18rem;
            text-align: center;
            line-height: .32rem;
            border: 0;
            outline: none;
            background: linear-gradient(90deg, rgba(129, 216, 255, 1) 0%, rgba(74, 176, 255, 1) 100%);

        }

        #thr {
            width: .76rem;
            height: .32rem;
            border-radius: .18rem;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-left: -0.38rem;
            margin-top: -0.16rem;
            font-size: .14rem;
        }


        .rule {
            width: .57rem;
            background: rgba(0, 0, 0, 0.29);
            border-radius: .2rem 0 0 .2rem;
            position: absolute;
            right: 0;
            top: .2rem;
            font-size: .12rem;
            color: #fff;
            padding: .05rem 0 .05rem .05rem;
            text-align: center;
        }

        .lucky {
            width: .7rem;
            background: #fff;
            border-radius: .2rem 0 0 .2rem;
            position: fixed;
            bottom: .89rem;
            right: 0;
            box-shadow: 0px 3px 7px 0px rgba(62, 142, 201, 0.31)
        }

        .lucky a {
            display: block;
            width: 100%;
            height: .32rem;
            line-height: .32rem;
            text-align: center;
            color: #DE5448;
            font-size: .13rem;
            position: relative;
            text-indent: .35rem;
        }

        .lucky a img {
            position: absolute;
            width: .18rem;
            height: .18rem;
            top: 50%;
            margin-top: -0.09rem;
            left: .15rem;
        }

        /* 投票规则 */
        .thorw_rlue {
            width: 2.95rem;
            height: 4.12rem;
            background: #fff;
            border-radius: .05rem;
            text-align: center;
            z-index: 999;
            position: fixed;
            top: 50%;
            left: 50%;
            margin-top: -2.06rem;
            margin-left: -1.475rem;
            display: none;
        }

        .thorw_rlue p {
            font-size: .18rem;
            padding: .3rem 0;
        }

        #box {
            max-height: 3rem;
            overflow: scroll;
        }

        .thorw_rlue .del_bo {
            width: .12rem;
            height: .12rem;
            position: absolute;
            top: .13rem;
            right: .14rem;
        }

        .thorw_rlue .item {
            text-align: left;
            margin-bottom: .1rem;
            padding: 0 .4rem;
            font-size: .14rem;
        }

        .thorw_rlue .del_bo img {
            display: block;
            width: 100%;
            height: 100%;
        }

        .loading {
            width: 100%;
            display: none;
            text-align: center;
            height: .5rem;
            line-height: .5rem;
            color: #fff;

        }

        .loading .box {
            width: 100%;
            height: .5rem;
            position: relative;
        }

        .loading img {
            width: .35rem;
            height: .35rem;
            position: absolute;
            left: 39%;
            top: 50%;
            margin-top: -0.175rem;

        }

        .loading p {
            color: #fff;
            position: absolute;
            line-height: .4rem;
            left: 50%;
            top: 50%;
            margin-top: -0.175rem;

        }

        /* 投票 */
        .model_totas {
            width: 2.95rem;
            height: 3.29rem;
            background: #fff;
            position: fixed;
            z-index: 999;
            border-radius: .08rem;
            top: 50%;
            left: 50%;
            margin-left: -1.475rem;
            margin-top: -1.645rem;
            text-align: center;
            display: none;
        }

        .model_totas .del_box {
            width: 100%;
            height: .3rem;
            position: relative;
        }

        .model_totas .throw_box img {
            width: 100%;
            height: 100%;
        }

        .model_totas .del_box img {
            display: block;
            width: .12rem;
            height: .12rem;
            position: absolute;
            top: .13rem;
            right: .14rem;
        }

        .model_totas .throw_box {
            width: .69rem;
            height: .77rem;
            margin: 0 auto;
        }

        .model_totas a {
            display: block;
            width: 1.27rem;
            height: .41rem;
            border-radius: .2rem;
            background: linear-gradient(90deg, rgba(131, 217, 255, 1) 0%, rgba(76, 177, 255, 1) 100%);
            color: #fff;
            line-height: .41rem;
            margin: 0 auto;
        }

        .no {
            width: .8rem;
            height: .32rem;
            line-height: .32rem;
            color: rgb(74, 176, 255);
            border-radius: .2rem;
            background: #fff;
            border: 0;
            outline: none;
            position: relative;
            font-size: .12rem;
            margin: 0 auto;
            text-indent: .1rem;
        }

        .throw_votes {
            position: relative;
            width: .8rem;
            height: .32rem;
            border-radius: .18rem;
            text-align: center;
            line-height: .32rem;
            outline: none;
            background: #fff;
            font-size: .14rem;
            margin: 0 auto;
        }

        .throw_img {
            width: .12rem;
            height: .12rem;
            position: absolute;
            top: 50%;
            margin-top: -0.06rem;
            left: .1rem;
        }
    </style>

</head>

<body>
    <div class="header">
        <!-- 投票规则 -->
        <div class="rule">投票规则</div>
        <ul class="clearfix" id="header_top">
            <!-- <li class="fl">
                <div class="use_imgbox">
                    <img class="user_img" src="/Public/Home/images/user_img.jpg" alt="">
                    <img class="crown" src="/Public/Home/images/icon_yin@2x.png" alt="">
                    <p class="rank">第二名</p>
                </div>
                <p class="user_name">真寻</p>
                <p class="throw_count">13314票</p>
                <button class="btn">支持他</button>
            </li>
            <li class="fl">
                <div class="frist_use_imgbox">
                    <img class="frist_user_img" src="/Public/Home/images/user_img.jpg" alt="">
                    <img class="crown" src="/Public/Home/images/icon_huang@2x.png" alt="">
                    <p class="rank">第一名</p>
                </div>
                <p class="user_name">湘淑</p>
                <p class="throw_count">13114票</p>
                <button class="btn">支持他</button>
            </li>
            <li class="fl">
                <div class="use_imgbox">
                    <img class="user_img" src="/Public/Home/images/user_img.jpg" alt="">
                    <img class="crown" src="/Public/Home/images/icon_tong@2x.png" alt="">
                    <p class="rank" style="background:#EBB16D;">第三名</p>
                </div>
                <p class="user_name">真名</p>
                <p class="throw_count">13124票</p>
                <button class="btn">支持他</button>
            </li> -->
        </ul>
    </div>
    <div class="main">
        <!-- <div class="list clearfix">
            <div class="fl">
                <img class="use" src="/Public/Home/images/mingpian1.png" alt="">
                <p>第四名</p>
            </div>
            <div class="fl">
                <p class="user">麦克</p>
                <p class="throw_c">当前获得票：<span>100票</span> </p>
                <div class="bottom_bg">
                    <div data-width="90" class="top_bg"></div>
                </div>
            </div>
            <div class="fl">
                <button class="throw_btn">支持他</button>
            </div>
        </div> -->
    </div>
    <div class="loading">
        <div class="box">
            <img class="" src="/Public/Home/images/new_load.gif" alt="">
            <p class="">加载中...</p>
        </div>
    </div>
    <!-- 抽奖 -->
    <div class="lucky">
        <a href="/index.php?s=/Home/Vote/draw.html&openid={$openid}">
            <img src="/Public/Home/images/icon_choujiang@3x.png" alt="">
            抽奖
        </a>
    </div>

    <!-- 投票规则 -->
    <div class="thorw_rlue">
        <div style="position:relative;">
            <p>投票规则</p>
            <div id="box">
                <div class="item">请您踊跃投票并参与抽奖，评选结果将在2018年12月10日洋小秘香港周年庆典现场公布并隆重举行颁奖表彰仪式。</div>
                <div class="item">投票规划：</div>
                <div class="item">【参选条件】 明鑫商学院首席讲师、专业讲师和助理讲师。</div>
                <div class="item">【投票规则】 关注并进入互浦科技公众号，每个手机号每天只能投票一次，一次最多三票。</div>
                <div class="item">【严禁行为】 如发现恶意刷票行为，将直接取消讲师资格。</div>
                <div class="item">【抽奖资格】 当天投票完成三票者，有资格参与抽奖。</div>
                <div class="item">【奖品发放】 所有获奖产品待活动结束后统一发出。</div>
                <div class="item">【评选依据】 网上投票占50%，综合考评占50%。</div>
                <div class="item">【投票时间】 2018年10月11日至11月10日。</div>
                <div class="item">注：活动最终解释权归上海互浦科技有限公司所有。</div>
            </div>
            <div class="del_bo">
                <img src="/Public/Home/images/inco_bianji_de@2x.png" alt="">
            </div>
        </div>
    </div>

    <div class="mask"></div>
    <!-- 投票 -->
    <div class="model_totas">
        <div class="del_box"><img src="/Public/Home/images/inco_bianji_de@2x.png" alt=""></div>
        <div class="throw_box"><img src="/Public/Home/images/success_ck.png" alt=""></div>
        <p style="font-size:.25rem;padding-top: .05rem;padding-bottom: .25rem;">投票成功</p>
        <p id="count" style="color:#9E9E9E;width: 2.2rem;margin: 0 auto;padding-bottom: .33rem">恭喜您投票成功，您还获得了一次<span
                style="color:#4CB0FF">免费抽奖</span>的机会。</p>
        <a href="javascript:void(0)" id="Continue">继续投票</a>
    </div>
</body>

</html>
<script>
    $(function () {

        var openid = '{$openid}';
        // 投票规则
        $(".rule").on("click", function () {
            $(".mask").show();
            $(".thorw_rlue").show();
        })
        $(".thorw_rlue").on("click", ".del_bo", function () {
            $(".mask").hide();
            $(".thorw_rlue").hide();
        })

        animate();

        function animate() {
            $(".bottom_bg .top_bg").each(function (i, e) {
                var width = parseInt($(e).attr("data-width"));
                $(this).animate({
                    width: width + '%'
                }, 800);

            })
        }
        var max_throw;

        $.ajax({
            type: "post",
            url: "/index.php?s=/Api/Vote/vote_user_top13",
            data: {
                openid: openid,
                n: 1,
                s: 8
            },
            success: function (res) {
                console.log(res)
                var two_list = res.AppendData.list;
                for (var a in two_list) {
                    for (var b in res.AppendData.uuid) {
                        if (two_list[a].uuuid == res.AppendData.uuid[b].vuuid) {
                            two_list[a].isfalg = res.AppendData.uuid[b].vuuid;
                            break;
                        }
                    }

                }
                res.AppendData.list = two_list;
                var obj = res.AppendData.list;
                var parme = {};
                var topthree = [];
                var rank = [];
                for (var i = 0; i < obj.length; i++) {
                    if (i <= 2) {
                        topthree.push(obj[i])
                    } else {
                        rank.push(obj[i])
                    }
                }
                parme.topthree = topthree;
                parme.rank = rank;
                console.log(parme)
                var top = '';
                var last_top = '';
                //最大投票数
                max_throw = res.AppendData.list[0].u_vote_num;
                //topthree排行
                top += '<li class="fl">'
                top += '<div class="use_imgbox">'
                top += '<img class="user_img" src="' + parme.topthree[1].u_img_top + '" alt="">'
                top += '<img class="crown" src="/Public/Home/images/icon_yin@3x.png" alt="">'
                top += '<p class="rank">第2名</p>'
                top += '</div>'
                top += '<p class="user_name">' + parme.topthree[1].uname + '</p>'
                top += '<p class="throw_count" id="con">' + parme.topthree[1].u_vote_num + '票</p>'
                if (parme.topthree[1].isfalg == null) {
                    top += '<div class="throw_votes"><button class="btn" data-uuid="' + parme.topthree[
                        1].uuuid + '">投票</button></div>'
                } else {
                    top +=
                        '<div class="throw_votes"><button class="no"><img class="throw_img" src="/Public/Home/images/success.png" style="display:show" alt="">已投票</button></div>'
                }

                top += '</li>'
                top += '<li class="fl">'
                top += '<div class="frist_use_imgbox">'
                top += '<img class="frist_user_img" src="' + parme.topthree[0].u_img_top +
                    '" alt="">'
                top += '<img class="crown" src="/Public/Home/images/icon_huang@3x.png" alt="">'
                top += '<p class="rank">第1名</p>'
                top += '</div>'
                top += '<p class="user_name">' + parme.topthree[0].uname + '</p>'
                top += '<p class="throw_count" id="con">' + parme.topthree[0].u_vote_num + '票</p>'

                if (parme.topthree[0].isfalg == null) {
                    top += '<div class="throw_votes"><button class="btn" data-uuid="' + parme.topthree[
                        0].uuuid + '">投票</button></div>'
                } else {
                    top +=
                        '<div class="throw_votes"><button class="no"><img class="throw_img" src="/Public/Home/images/success.png" style="display:show" alt="">已投票</button></div>'
                }

                top += '</li>'
                top += '<li class="fl">'
                top += '<div class="use_imgbox">'
                top += '<img class="user_img" src="' + parme.topthree[2].u_img_top + '" alt="">'
                top += '<img class="crown" src="/Public/Home/images/icon_tong@3x.png" alt="">'
                top += '<p class="rank" style="background:#EBB16D;">第3名</p>'
                top += '</div>'
                top += '<p class="user_name">' + parme.topthree[2].uname + '</p>'
                top += '<p class="throw_count" id="con">' + parme.topthree[2].u_vote_num + '票</p>'
                if (parme.topthree[2].isfalg == null) {
                    top += '<div class="throw_votes"><button class="btn" data-uuid="' + parme.topthree[
                        2].uuuid + '">投票</button></div>'
                } else {
                    top +=
                        '<div class="throw_votes"><button class="no"><img class="throw_img" src="/Public/Home/images/success.png" style="display:show" alt="">已投票</button></div>'
                }
                top += '</li>'

                $("#header_top").html(top);

                $.each(parme.rank, function (k, v) {
                    var bili = (v.u_vote_num / max_throw) * 100;
                    last_top += '<div class="list clearfix">'
                    last_top += '<div class="fl">'
                    last_top += '<img class="use" src="' + v.u_img_top + '" alt="">'
                    last_top += '<p>第' + (k + 4) + '名</p>'
                    last_top += '</div>'
                    last_top += '<div class="fl">'
                    last_top += '<p class="user">' + v.uname + '</p>'
                    last_top += '<p class="throw_c">当前获得票：<span id="con">' + v.u_vote_num +
                        '票</span> </p>'
                    last_top += '<div class="bottom_bg">'
                    last_top += '<div data-width="' + bili + '" class="top_bg"></div>'
                    last_top += '</div>'
                    last_top += '</div>'
                    last_top += '<div class="fl">'
                    if (v.isfalg == null) {
                        last_top += '<div id="thr">'
                        last_top += '<button class="throw_btn btn" data-uuid="' + v.uuuid + '">投票</button>'
                        last_top += '</div>'
                    } else {
                        last_top += '<div id="thr">'
                        last_top += '<button class="throw_btn btn" style="font-size:.12rem;text-indent:.15rem;"><img class="throw_img" src="/Public/Home/images/success.png" alt="">已投票</button>'
                        last_top += '</div>'
                    }

                    last_top += '</div>'
                    last_top += '</div>'
                })

                $(".main").html(last_top);
                animate();
            }
        })


        var scrollFlag = true;
        var page = 1;
        var count = 1;
        $(window).scroll(function () {
            //已经滚动到上面的页面高度
            var scrollTop = $(this).scrollTop();
            //页面高度
            var scrollHeight = $(document).height();
            //浏览器窗口高度
            var windowHeight = $(this).height();
            //此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
            if (!scrollFlag) {
                return false;
            }
            if (scrollTop + windowHeight == scrollHeight) {
                page += 1;
                count += 8;
                scrollFlag = false;
                $.ajax({
                    url: "/index.php?s=/Api/Vote/vote_user_top13",
                    type: "post",
                    data: {
                        openid: openid,
                        n: page,
                        s: 8
                    },
                    beforeSend: function () {
                        $(".loading").show();
                    },
                    success: function (res) {
                        var two_list = res.AppendData.list;
                        for (var a in two_list) {
                            for (var b in res.AppendData.uuid) {
                                 if (two_list[a].uuuid == res.AppendData.uuid[b].vuuid) {
                                     two_list[a].isfalg = res.AppendData.uuid[b].vuuid;
                                     break;
                                }
                        }

                        }
                        $(".loading").hide();
                        scrollFlag = true;
                        if (res.AppendData.list.length == 0) {
                            scrollFlag = false;
                            $(".loading").show().html("没有更多数据了")
                            console.log("没有更多数据了")
                        }
                        console.log(res)
                        var last_top = '';
                        $.each(res.AppendData.list, function (k, v) {

                            var bili = (v.u_vote_num / max_throw) * 100;

                            last_top += '<div class="list clearfix">'
                            last_top += '<div class="fl">'
                            last_top += '<img class="use" src="' + v.u_img_top +
                                '" alt="">'
                            last_top += '<p>第' + (k + count) + '名</p>'
                            last_top += '</div>'
                            last_top += '<div class="fl">'
                            last_top += '<p class="user">' + v.uname + '</p>'
                            last_top += '<p class="throw_c">当前获得票：<span id="con">' +
                                v.u_vote_num +
                                '票</span> </p>'
                            last_top += '<div class="bottom_bg">'
                            last_top += '<div data-width="' + bili +
                                '" class="top_bg"></div>'
                            last_top += '</div>'
                            last_top += '</div>'
                            last_top += '<div class="fl">'

                            if (v.isfalg == null) {
                                last_top += '<div id="thr">'
                                last_top += '<button class="throw_btn btn" data-uuid="' + v.uuuid + '">投票</button>'
                                last_top += '</div>'
                            } else {
                                last_top += '<div id="thr">'
                                last_top += '<button class="throw_btn btn" style="font-size:.12rem;text-indent:.15rem;"><img class="throw_img" src="/Public/Home/images/success.png" alt="">已投票</button>'
                                last_top += '</div>'
                            }

                            last_top += '</div>'
                            last_top += '</div>'
                        })

                        $(".main").append(last_top);
                        setTimeout(function () {
                            animate();
                        }, 1000)

                        ends()

                    }
                })

            }
        });


        $("#header_top").on("click", ".throw_votes", function () {
            var uuid = $(this).find("button").attr("data-uuid");
            var that = $(this);
            var thorw_counts = that.parent().find("#con");
            var newarr = thorw_counts.text().split('票');
            var count = newarr[0];
            // console.log(count)
            $.ajax({
                url: "/index.php?s=/Api/Vote/user_vote_log",
                type: "post",
                data: {
                    openid: openid,
                    uuuid: uuid
                },
                success: function (res) {
                    console.log(res)
                    if (res.ResultType == 0) {
                        var newcount = parseInt(count) + 1
                        thorw_counts.text(newcount + "票");
                        if (res.AppendData == 1 && res.Message == '投票成功') {
                            $("#count").html('恭喜您投票成功，您还有两次的投票机会');
                            $(".mask").show();
                            $(".model_totas").show();
                            that.css({
                                'font-size': '.12rem',
                                'color': '#4AB0FF',
                                'text-indent': '.2rem'

                            }).html(
                                '<img class="throw_img" src="/Public/Home/images/success.png" style="display:show" alt="">投票成功'
                            )
                        } else if (res.AppendData == 2 && res.Message == '投票成功') {
                          $(".mask").show();
                            $(".model_totas").html(
                                '<div class="del_box"><img src="/Public/Home/images/inco_bianji_de@2x.png" alt=""></div><div class="throw_box"><img src="/Public/Home/images/success_ck.png" alt=""></div><p style="font-size:.25rem;padding-top: .05rem;padding-bottom: .25rem;">投票成功</p><p id="count" style="color:#9E9E9E;width: 2.2rem;margin: 0 auto;padding-bottom: .33rem">恭喜您投票成功，您还有两次的投票机会</p><a href="javascript:void(0)" id="Continue">继续投票</a>'
                            ).show();
                            $("#count").html('恭喜您投票成功，您还有一次的投票机会');
                            that.css({
                                'font-size': '.12rem',
                                'color': '#4AB0FF',
                                'text-indent': '.2rem'
                            }).html(
                                '<img class="throw_img" src="/Public/Home/images/success.png" style="display:show" alt="">投票成功'
                            )
                        } else {
                             $(".mask").show();
                               $(".model_totas").html(
                                '<div class="del_box"><img src="/Public/Home/images/inco_bianji_de@2x.png" alt=""></div><div class="throw_box"><img src="/Public/Home/images/success_ck.png" alt=""></div><p style="font-size:.25rem;padding-top: .05rem;padding-bottom: .25rem;">投票成功</p><p id="count" style="color:#9E9E9E;width: 2.2rem;margin: 0 auto;padding-bottom: .33rem">恭喜您投票成功，您还有两次的投票机会</p><a href="javascript:void(0)" id="Continue">继续投票</a>'
                            ).show();
                                $("#count").html(
                                '恭喜您投票成功，您还获得了一次<span style="color:#4CB0FF">免费抽奖</span>的机会。'
                            );
                            $("#Continue").attr("href",
                                "/index.php?s=/Home/Vote/draw.html&openid=" + openid +
                                "").html('点击领取');
                            that.css({
                                'font-size': '.12rem',
                                'color': '#4AB0FF',
                                'text-indent': '.2rem'
                            }).html(
                                '<img class="throw_img" src="/Public/Home/images/success.png" style="display:show" alt="">投票成功'
                            )
                        }
                    } else if(res.ResultType==3 && res.Message=="活动已截止"){
                        alert("活动已截止");
                    } else {
                        $(".mask").show();
                        $(".model_totas").html(
                            '<div class="del_box"><img src="/Public/Home/images/inco_bianji_de@2x.png" alt=""></div><h5 style="margin-top:.1rem;margin-bottom:.47rem;">温馨提示</h5><p style="color:#9e9e9e;margin-bottom:1.2rem;padding:0 .2rem;">每人每天只有三次投票机会,不能重复投票同一人。</p><button id="know" style="width:1.27rem;height:.41rem;text-align: center;line-height: .41rem;background:linear-gradient(90deg,rgba(131,217,255,1) 0%,rgba(76,177,255,1) 100%);color: #fff;margin: 0 auto;border:0;outline:none;border-radius: .2rem;">我知道</button>'
                        )
                        $(".model_totas").show();
                    }

                }
            })

        })

        $(".main").on("click", ".throw_btn", function () {
            var that = $(this);
            var uuid = $(this).attr("data-uuid");
            var throw_count = that.parents(".fl").prev().find("#con");
            var newarr = throw_count.text().split("票");
            var count = newarr[0]
            // console.log(count)
            $.ajax({
                url: "/index.php?s=/Api/Vote/user_vote_log",
                type: "post",
                data: {
                    openid: openid,
                    uuuid: uuid
                },
                success: function (res) {
                    console.log(res)
                    if (res.ResultType == 0) {
                        var newcount = parseInt(count) + 1
                        throw_count.text(newcount + "票");
                        if (res.AppendData == 1 && res.Message == '投票成功') {
                            $("#count").html('恭喜您投票成功，您还有两次的投票机会');
                            $(".mask").show();
                            $(".model_totas").show();
                            that.css({
                                'font-size': '.12rem',
                                'color': '#4AB0FF',
                                'background': '#fff',
                                'text-indent': '0.22rem'

                            }).removeAttr("data-uuid").html(
                                '<img class="throw_img" src="/Public/Home/images/success.png" alt="">投票成功'
                            )
                        } else if (res.AppendData == 2 && res.Message == '投票成功') {
                            $(".mask").show();
                            $(".model_totas").html(
                                '<div class="del_box"><img src="/Public/Home/images/inco_bianji_de@2x.png" alt=""></div><div class="throw_box"><img src="/Public/Home/images/success_ck.png" alt=""></div><p style="font-size:.25rem;padding-top: .05rem;padding-bottom: .25rem;">投票成功</p><p id="count" style="color:#9E9E9E;width: 2.2rem;margin: 0 auto;padding-bottom: .33rem">恭喜您投票成功，您还有两次的投票机会</p><a href="javascript:void(0)" id="Continue">继续投票</a>'
                            ).show();
                            $("#count").html('恭喜您投票成功，您还有一次的投票机会');
                            that.css({
                                'font-size': '.12rem',
                                'color': '#4AB0FF',
                                'background': '#fff',
                                'text-indent': '0.22rem'

                            }).removeAttr("data-uuid").html(
                                '<img class="throw_img" src="/Public/Home/images/success.png" alt="">投票成功'
                            )
                        } else {
                            $(".mask").show();
                               $(".model_totas").html(
                                '<div class="del_box"><img src="/Public/Home/images/inco_bianji_de@2x.png" alt=""></div><div class="throw_box"><img src="/Public/Home/images/success_ck.png" alt=""></div><p style="font-size:.25rem;padding-top: .05rem;padding-bottom: .25rem;">投票成功</p><p id="count" style="color:#9E9E9E;width: 2.2rem;margin: 0 auto;padding-bottom: .33rem">恭喜您投票成功，您还有两次的投票机会</p><a href="javascript:void(0)" id="Continue">继续投票</a>'
                            ).show();
                                $("#count").html(
                                '恭喜您投票成功，您还获得了一次<span style="color:#4CB0FF">免费抽奖</span>的机会。'
                            );
                            $("#Continue").attr("href",
                                "/index.php?s=/Home/Vote/draw.html&openid=" + openid +
                                "").html('点击领取');
                            that.css({
                                'font-size': '.12rem',
                                'color': '#4AB0FF',
                                'background': '#fff',
                                'text-indent': '0.22rem'

                            }).removeAttr("data-uuid").html(
                                '<img class="throw_img" src="/Public/Home/images/success.png" alt="">投票成功'
                            )
                        }
                    }
                    if (res.ResultType != 0) {
                        $(".mask").show();
                        $(".model_totas").html(
                            '<div class="del_box"><img src="/Public/Home/images/inco_bianji_de@2x.png" alt=""></div><h5 style="margin-top:.1rem;margin-bottom:.47rem;">温馨提示</h5><p style="color:#9e9e9e;margin-bottom:1.2rem;padding:0 .2rem;">每人每天只有三次投票机会,不能重复投票同一人。</p><button id="know" style="width:1.27rem;height:.41rem;text-align: center;line-height: .41rem;background:linear-gradient(90deg,rgba(131,217,255,1) 0%,rgba(76,177,255,1) 100%);color: #fff;margin: 0 auto;border:0;outline:none;border-radius: .2rem;">我知道</button>'
                        )
                        $(".model_totas").show();

                    }


                }

            })


        })

        //继续投票
        $(".model_totas").on("click","#Continue", function () {
            $(".mask").hide();
            $(".model_totas").hide();
        })

        $(".model_totas").on("click", '.del_box', function () {
            $(".mask").hide();
            $(".model_totas").hide();
        })
        //我知道了
        $(".model_totas").on("click", "#know", function () {
            $(".mask").hide();
            $(".model_totas").hide();
        })

        var number = 0;
        function ends (){
        var get_time = Math.round(new Date() / 1000);  //获取当前时间戳
        var end_time = 1541865600; //结束时间戳
        console.log(get_time)
        if(get_time >= end_time){
            number++;
            if(number == 1){
                 alert('投票活动已结束');
            }
            $('button').css('background','#ccc').attr('disabled','disabled');
            $('.lucky a').attr('href','javascript:;') //中奖记录禁止跳转了
            clearInterval(timer)
             
        }
    }


    var timer = setInterval(ends,1000);



    })
</script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
<script type="text/javascript">
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        // 通过下面这个API隐藏右上角按钮hideOptionMenu
        WeixinJSBridge.call('hideOptionMenu');
    });
</script>