<?php/***********消息列表逻辑层************ */namespace app\api\logic;use think\Model;use app\api\model\UserInfo  as userModel;use app\api\model\MsgList  as MsgModel;class MsgList extends Model{    private $User=null;	private $Msg=null;    function __construct(){        $this->User = new userModel();        $this->Msg = new MsgModel();    }    public function addMsg($options=array())    {    	//添加消息列表        $data['user_id']=$options['user_id'];        $data['object_id']=$options['object_id'];        $data['type']=$options['type'];        $data['msg']=$options['msg'];        $data['status']=1;        $data['is_read']=0;        $data['add_time']=time();        $id = $this->Msg->insert($data);                return $id;    }    public function getMsgCount($options=array(),$option1 = array())    {        //添加消息列表        $list=$this->Msg->where($options)->group('type')->field('type,count(*) as counts')->select();        $list['mine']['type'] = 'mine';        $list['mine']['counts'] = $this->Msg->where($option1)->where(array('type'=>1))->count();        return $list;    }    public function getMsgList($options=array(),$orderBy = '')    {        //获取消息列表        $list=$this->Msg->where($options)->order($orderBy)->select();        return $list;    }    public function getMsgList_xcx($options=array(),$limit=array(),$orderBy = 'id desc')    {        //获取消息列表         $list = Db::table('s_MsgList')->where($options)->limit($limit)->order($orderBy)->select();         foreach ($list as $key=>$value)         {             $user = Db::table('s_user_detail')->where(array('id'=>$value['object_id']))->field('headimg,nick_name,unionid')->find();             if($user){                 if(substr($user['headimg'],0,4) != 'http'){                     $list[$key]['headimg'] = 'https://wap.yxm360.com'.$user['headimg'];                 }else{                     $list[$key]['headimg'] = $user['headimg'];                 }                 $list[$key]['nick_name'] = $user['nick_name'];                 $list[$key]['add_time_xcx']=date('Y-m-d H:i:s',$list[$key]['add_time']);             }else{                 unset($list[$key]);             }         }                 $list = array_values($list);        return $list;    }    public function delMsg($options=array())    {        //删除消息        $flag=$this->Msg->where($options)->delete();        return $flag;    }    public function redMsg($where)    {        //标记消息已读        return $this->Msg->where($where)->save(array('is_read'=>1));    }    public function getRedMsg($options=array())    {        //获取是否有已读消息        $where['user_id']=$options['user_id'];        $where['is_read']=0;        $count=$this->Msg->where($where)->count();        return $count>0?true:false;    }}