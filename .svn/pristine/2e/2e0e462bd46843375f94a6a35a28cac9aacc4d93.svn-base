<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" >  
    <title>背景</title>
    <link rel="stylesheet" href="__HOME_CSS__/wh/base.css">
    <link rel="stylesheet" href="__HOME_JS__/whjs/js/jquery.cxcolor.css">
    <script src="__HOME_JS__/whjs/js/rem.js"></script>
    <script src="__HOME_JS__/whjs/js/jquery-1.8.3.min.js"></script>
    <script src="__HOME_JS__/whjs/js/jquery.cxcolor.js"></script>
    <style>
        body,html{
            max-width: 750px;
            min-width: 320px;
            margin: 0 auto;
            background: #f6f6f7;
             height: 100%;
            overflow: hidden !important;
        }
        #content{
            width: 100%;
            background: #fff;
            height: 100%;
            overflow: hidden !important;
        }

         .title{
            width: 90%;
            margin: 0 auto;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .ulbox li{
            width: 20%;
            height: 3rem;
            text-align: center;
        }

        .ulbox li p{
            font-size: 0.6rem;
        }

        .ulbox li img{
            width: 70%;
        }

        .hkbj{
            height: 2rem;
            text-indent: 1rem;
            line-height: 2rem;
            border-top: 1px solid #eee;
        }

        .background{
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            height: 6rem;
            width: 90%;
            margin: 0 auto;
        }

        .background > .fl{
                width: 46%;
                height: 5rem;
                margin-top: 0.5rem;
                position: relative;
                /* background-image: url(http://wx.yxm360.com/Uploads/Card/2018-01-05/5a4f622e79cf1.png); */
                background-size: 100% 100%;
                background-repeat: no-repeat;
        }

            .background > .fl p{
                position: absolute;
                width: 4rem;
                height: 1rem;
                font-size: 0.8rem;
                text-align: center;
                top: 50%;
                left: 50%;
                margin-top: -0.5rem;
                margin-left: -2rem;
        }
         .background > .fr{
                width: 49%;
                height: 5rem;
                margin-top: 0.5rem;
                line-height: 5rem;
                
        }

         .background > .fr .fl{
                width: 50%;
                height: 100%;

         }

           .background > .fr .fr{
                width: 50%;
                height: 100%;

         }

           .background > .fr .fl >.item{
                height: 3rem;
                width: 3rem;
                margin: 0 auto;
                border-radius: 50%;
                border: 1px solid #eee;
                
         }

            .background > .fr .fr >.item{
                height: 3rem;
                width: 3rem;
                margin: 0 auto;
                border-radius: 50%;
                border: 1px solid #eee;
                
         }

          .background > .fr .fl >p{
              height: 1rem;
              width: 100%;
              overflow: hidden;
              line-height: 1rem;
              font-size: 0.6rem;
              text-align: center;
              margin-top: 0.5rem;
          }

             .background > .fr .fr >p{
              height: 1rem;
              width: 100%;
              overflow: hidden;
              line-height: 1rem;
              font-size: 0.6rem;
              text-align: center;
              margin-top: 0.5rem;
          }

          .tips{
              width: 90%;
              margin: 0 auto;
          }

          .tips .imgbox{
                width: 3rem;
                height: 3rem;
                margin-top: 0.5rem;
                margin-bottom: 0.5rem;
                position: relative;
          }

          .tips .imgbox img{
              width: 100%;
              height: 100%;
          }

          .tips .type{
              width: 70%;
              margin-left: 0.5rem;
              margin-top: 1rem;
              
          }

          .tips .type p{
              font-size: 0.7rem;
              color: #666;
          }

          .fx{
              width: 100%;
              position: fixed;
              bottom: 0;
              left: 0;
              
          }

           .fx button{
               width: 50%;
               height: 2.5rem;
               border: 0;
           }

            .fx .yl{
               background: #eee;
           }
            .fx .confirm{
                color: #fff;
                background: #2FB3D3;
            }
                 .save_check{
                 width: 8rem;
                 height: 1.8rem;
                 line-height: 1.8rem;
                 color: #fff;
                 font-size: 0.9rem;
                 background:rgba(0,0,0,.5);
                 position: fixed;
                 bottom: 4rem;
                 left: 50%;
                 margin-left: -4rem;
                 text-align: center;
                 border-radius: 3px;
                 display: none;
             }

             .chose_check{
                 width: 15rem;
                 height: 12rem;
                 position: fixed;
                 top: 50%;
                 left: 50%;
                 margin-top: -6rem;
                 margin-left: -7.5rem;
                 background: #fff;
                 z-index: 100;

             }

              .chose_check ul li{
                  width: 16%;
                  height: 1.9rem;
                  background: dodgerblue;
                  margin-top: 0.5rem;
                  margin-left: 0.5rem;
              }

             .mask{
                 width: 100%;
                 height: 100%;
                 background: rgba(0,0,0,.5);
                 position: fixed;
                 top:0;
                 left: 0;
                 /* display: none; */
             }

             .cxcolor td{
                 width: 10%;
                 height: 1rem;
             }

             .cxcolor .panel_hd{
                 width: 97%;
             }

             .cxcolor{
                 width: 18.8rem;
                 height: 14rem;
                 top: 50% !important;
                 left: 50% !important;
                 margin-top: -10rem;
                 margin-left: -9.4rem;
                 overflow: unset;
             }

             .cxcolor table {
                 table-layout:auto !important;
                 height: 100%;
                 width: 100%;
                 overflow: hidden;
             }

             #upimg{
                 position: absolute;
                 width: 100%;
                 height: 100%;
                 left: 0;
                 top: 0;
                 opacity: 0;
                 z-index: 1;
             }

          

            
    
    </style>
</head>
<body>
    <div id="content">
        <div class="title">
            <ul class="ulbox clearfix">
                <li class="fl">
                    <a id="href_one" href="index.php?s=/Home/Holidaycard/grats">
                        <img src="/Public/Home/images/h_icon_1.png" alt="">
                        <p>贺词</p>
                    </a>
                </li>
                <li class="fl">
                    <a id="href_two" href="index.php?s=/Home/Holidaycard/beijing">
                        <img src="/Public/Home/images/h_icon_2_on.png" alt="">
                        <p>背景</p>
                    </a>
                </li>
                <li class="fl">
                    <a id="href_three" href="index.php?s=/Home/Holidaycard/music">
                        <img src="/Public/Home/images/h_icon_3.png" alt="">
                        <p>音乐</p>
                    </a>
                </li>
                <li class="fl">
                    <a id="href_four" href="index.php?s=/Home/Holidaycard/share">
                        <img src="/Public/Home/images/h_icon_4.png" alt="">
                        <p>分享</p>
                    </a>
                </li>
                <li class="fl">
                    <a id="href_five" href="index.php?s=/Home/Holidaycard/layout">
                        <img src="/Public/Home/images/h_icon_5.png" alt="">
                        <p>布局</p>
                    </a>
                </li>
            </ul>
        </div>
        <div class="hkbj">贺卡背景文字颜色</div>
        <div class="background clearfix">
            <div id="color_text" class="fl">
                <p>文字颜色</p>
            </div>
            <div class="fr">
                <div class="fl">
                    <div id="txcolor" class="item"></div>
                    <p>文字色</p>
                </div>                             
                <div class="fr">
                    <div id="mbcolor" class="item"></div>
                    <p>描边色</p>
                </div>
            </div>
        </div>
        <div class="tips clearfix">
            <div class="imgbox fl">
                <img id="sltimg" src="" alt="">
                <input id="upimg" type="file" accept="image/*">
            </div>
            <div class="fl type">
                <p>类型：jpg .png</p>
                <p>图片比例640*1136图片最佳效果</p>
            </div>
        </div>
        <div class="fx clearfix">
            <button class="yl fl">预览</button>
            <button class="confirm fl">保存</button>
        </div>


    </div>
    <div class="save_check">保存成功</div>
    <!-- <div class="chose_check">
        <ul id="ulcolor" class="clearfix color_box">
            <li class="fl"></li>
            <li class="fl"></li>
            <li class="fl"></li>
            <li class="fl"></li>
            <li class="fl"></li>
            <li class="fl"></li>
            <li class="fl"></li>
        </ul>
    </div>
    <div class="mask"></div> -->
</body>
</html>
<script>
    function GetQueryString(name) {
        if (window.location.href.indexOf('?') > -1) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = decodeURIComponent(window.location.href.substr(1).split('?')[1]).match(reg);
            if (r != null) return unescape(r[2]);
        }
        return '';//便于容错处理
    }

    var gid = GetQueryString("gid");
    console.log(gid)

    $("#href_one").attr("href", "index.php?s=/Home/Holidaycard/grats&gid=" + gid + "");
    $("#href_two").attr("href", "index.php?s=/Home/Holidaycard/beijing&gid=" + gid + "");
    $("#href_three").attr("href", "index.php?s=/Home/Holidaycard/music&gid=" + gid + "");
    $("#href_four").attr("href", "index.php?s=/Home/Holidaycard/share&gid=" + gid + "");
    $("#href_five").attr("href", "index.php?s=/Home/Holidaycard/layout&gid=" + gid + "");





    $('#txcolor').cxColor();
    $('#mbcolor').cxColor();
    var textcolor;
    var mbscolor;
   $(document).on("click","td",function(){
        textcolor = $("#txcolor").css("background-color"); //文字色
        mbscolor = $("#mbcolor").css("background-color");  //描边色 
        var reg  = /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;
       /*RGB颜色转换为16进制*/
       String.prototype.colorHex  = function () {
               var that = this;
               if (/^(rgb|RGB)/.test(that)) {
                   var aColor  = that.replace(/(?:\(|\)|rgb|RGB)*/g, "").split(",");
                   var strHex= "#";
                   for (var i = 0;
                       i < aColor.length; i++) {
                       var hex    = Number(aColor[i]).toString(16);
                       if (hex  === "0") {
                           hex += hex;
                       }
                       strHex += hex;
                   }
                   if (strHex.length !== 7) {
                       strHex  = that;
                   }
                   return strHex;
               } else if (reg.test(that)) {
                   var aNum = that.replace(/#/, "").split("");
                   if (aNum.length === 6) {
                       return that;
                   } else if (aNum.length === 3) {
                       var numHex  = "#";
                       for (var i = 0;
                           i < aNum.length; i += 1) {
                           numHex += (aNum[i] + aNum[i]);
                       }
                       return numHex;
                   }
               } else {
                   return that;
               }
           };

             
       textcolor = textcolor.colorHex()
       mbscolor = mbscolor.colorHex()
       $("#color_text p").css("color", textcolor);
       $("#color_text p").css("text-shadow", "2px 2px 1px" + mbscolor + "");

   })

    
                
           

var id = '{$id}';
    $.ajax({
        url:"index.php?s=/Api/IndexApi/get_gcard",
        type:"post",
        data:{
            id:id,
            cardid: gid,
        },
        success:function(res){
            console.log(res)
            $.each(res.AppendData,function(k,v){
                $("#color_text").css("background-image","url('"+v.pic+"')");
                $("#color_text p").css("color", v.font_color);
                $("#color_text p").css("text-shadow", "1px 1px" + v.font_border_color +"");

                $("#sltimg").attr("src",v.pic);
                $("#txcolor").css("background-color",v.font_color);  // 文字颜色
                $("#mbcolor").css("background-color",v.font_border_color); // 文字描边色

            })
        }
    })

    $(".confirm").on("click",function(){
        $.ajax({
            url:"index.php?s=/Api/IndexApi/addGcard",
            type:"post",
            data:{
                id:id,
                card_id: gid,
                font_color: textcolor,
                font_border_color: mbscolor,
                pic: downimg

            },
            success:function(res){
                console.log(res)
                 $(".save_check").text("保存成功").stop(true).fadeIn(500);
                $(".save_check").fadeOut(2000);
            }
        })
        
    })

    $(".yl").on("click", function () {
        location.href = "index.php?s=/Home/Holidaycard/showview/gid/" + gid + "/id/" + id + "";
    })

    var upimg;
    var downimg;
    window.onload = function(){
    $("#upimg").on("change",function(){
        if(window.FileReader){
            var filepath = $(this).val();
            var file = this.files[0];

            var render = new FileReader();
            render.readAsDataURL(file);
            render.onload = function(res){
                console.log(res)
                upimg = res.target.result;

                $.ajax({
                    url:"index.php?s=/Api/IndexApi/uploads_img",
                    type:"post",
                    data:{
                        id:id,
                        img: upimg,
                        start_name:"greeting"
                    },
                    success:function(res){
                        console.log(res.AppendData)
                        downimg = res.AppendData;
                        $("#sltimg").attr("src", downimg);
                        $("#color_text").css("background-image", "url('" + downimg + "')");
                    }
                })

               

            }
          

        }else{
            alert("您的设备不支持图片预览功能，如需该功能请升级您的设备！")
        }
    })

}
    

</script>