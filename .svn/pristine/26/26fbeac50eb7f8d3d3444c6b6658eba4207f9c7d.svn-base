<?phpnamespace app\common\controller;use think\Cache;use think\Controller;use think\Db;/** * Api 基类控制器 */class ApiBase  extends Controller{	    /**     * 初始化方法     */    const __OK__ = '0'; //请求成功    const __ERROR__ = '1'; //参数错误    const __ERROR1__ = '2'; //没有绑定    const __ERROR2__ = '3';//数据库错误    const __ERROR4__ = '4';//未查询到数据    const __ERROR5__ = '5';//条件不符合    public $code_expire_time = 60;//验证码过期时间    public $array_return = array("ResultType"=>1,"Message"=>"success","AppendData"=>[]);    public $userInfo;    public $_reqparam;    public function initialize()    {    	$_reqparam = $this->request->param();        $this->userInfo = session("user_info") ? session("user_info") : array();        $act_name = strtolower($this->request->action());        $cnt_name = strtolower($this->request->controller());        $conf = config('NO_APP_LOGIN');        if(isset($conf[$cnt_name]) && in_array($act_name,$conf[$cnt_name]))         {    		return ;	    }        if ($this->_reqparam['unionid'] || $this->_reqparam['spopenid'])         {        	$this->array_return['ResultType'] = self::__ERROR__;            $this->array_return['Message'] = "非法访问";            $this->array_return['data'] = null;            return json($this->array_return);        }        if (!$this->userInfo) {        	$uid = Db::table('s_member')->where(array('unionid' => $this->_reqparam['unionid']))->value('id');         	$this->userInfo = Db::table('s_user_info')->field('user_id,headimg,nick_name')->where(array('user_id'=>$uid))->find();            } else {            $this->_reqparam['userInfo'] = $this->userInfo;        }    }    public function checklogin($uid, $token)    {        $where = array();        $where['id'] = array('EQ', $uid);        $res = Db::table('s_userInfo')->where($where)->find();        if ($res['token'] != $token) {            Util::response('1009', '请重新登录', null);            exit();        } else {            unset($res['passwd']);            return $res;        }    }    /**     * 前段用户注销     */    public function logQianOut()    {        // 清楚所有session        session(null);        echo json_encode('注销成功');    }}