<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>其他设置</title>
		<script src="__HOME_JS__/yb/js/rem.js"></script>
		<script src="__HOME_JS__/yb/js/jquery-3.1.1.min.js"></script>
		<style>
			* {
				padding: 0;
				margin: 0;
			}
			
			body {
				width: 100%;
				height: 100%;
				background: #fff;
			}
			
			.top {
				width: 90%;
				height: 3.55rem;
				margin: 0 auto;
				display: flex;
			}
			
			.top_left {
				width: 85%;
				height: 100%;
			}
			
			.top_up {
				width: 100%;
				height: 2rem;
				line-height: 2.5rem;
				font-size: 0.8rem;
				font-weight: 600;
				color: #333;
			}
			
			.top_down {
				width: 100%;
				height: 1.55rem;
				line-height: 1rem;
				font-weight: 400;
				font-size: 0.6rem;
				color: #C5C5C5;
			}
			
			.add {
				width: 15%;
				height: 100%;
			}
			
			.a_cen {
				width: 1rem;
				height: 1rem;
				line-height: 1rem;
				color: #F8C85E;
				border: 0.065rem solid #F8C85E;
				border-radius: 50%;
				text-align: center;
				font-size: 1rem;
				margin: 1.275rem 0 1.275rem 54%;
			}
			
			.texts {
				width: 100%;
				height: auto;
			}
			
			.txt {
				width: 90%;
				height: auto;
				background: rgba(255, 255, 255, 1);
				box-shadow: 0rem 0.1rem 0.4rem 0rem rgba(185, 185, 185, 0.5);
				margin: 0 auto 1.2rem;
				padding-bottom: 0.5rem;
				position: relative;
			}
			
			.txt_up {
				width: 90%;
				height: 1.9rem;
				line-height: 2.4rem;
				font-size: 0.8rem;
				color: #333;
				margin: 0 auto;
			}
			
			.ipt {
				width: 90%;
				height: 2.2rem;
				margin: 0 auto;
				border-bottom: 0.025rem solid #f3f3f3;
			}
			
			.ipt>input {
				width: 100%;
				height: 100%;
				border: none;
				outline: none;
				font-size: 0.7rem;
				color: #777777;
			}
			
			.icon {
				width: 90%;
				height: 2.675rem;
				line-height: 2.675rem;
				font-size: 0.8rem;
				margin: 0 auto;
				border-bottom: 0.025rem solid #f3f3f3;
			}
			
			.icon>a {
				display: flex;
				width: 100%;
				height: 100%;
				text-decoration: none;
				color: #333;
				display: flex;
			}
			
			.i_left {
				width: 75%;
				height: 100%;
			}
			
			.i_cen {
				width: 11%;
				height: 100%;
			}
			
			.c_img {
				width: 1.6rem;
				height: 1.6rem;
				border-radius: 50%;
				background: #32CEA0;
				text-align: center;
				margin: 0.5375rem 0;
				float:right;
			}
			
			.c_img>img {
				width: 0.8rem;
				height: 0.8rem;
				margin: 0.4rem 0;
			}
			
			.i_right {
				width: 5%;
				height: 100%;
				text-align: right;
			}
			
			.i_right>img {
				width: 0.3rem;
				height: 0.575rem;
			}
			
			.links {
				width: 90%;
				height: auto;
				margin: 0 auto 0.5rem;
			}
			
			.links_up {
				width: 100%;
				height: 2.5rem;
				line-height: 2.5rem;
				font-size: 0.8rem;
				color: #333;
			}
			
			.links_lian {
				width: 100%;
				min-height: 1.8rem;
				font-size: 0.7rem;
				outline: none;
				color: #777777;
				border-bottom: 0.025rem solid #F3F3F3;
			}
			
			.links_lian:empty::before {
				color: #9B9B9B;
				content: attr(placeholder);
			}
			
			.foot {
				width: 90%;
				height: 3rem;
				line-height: 3rem;
				border-bottom: 0.025rem solid #f6f6f6;
				margin: 0 auto;
				display: flex;
				font-size: 0.8rem;
				color: #333;
			}
			
			.foot_left,
			.foot_right {
				width: 50%;
				height: 100%;
			}
			
			.foot_right {
				width: 50%;
				height: 100%;
				text-align: right;
			}
			/*开关按钮*/
			
			.kai,
			.text {
				display: none;
			}
			
			.on {
				color: #fff;
				position: absolute;
				top: 0;
				left: 0;
				display: none;
			}
			
			.off {
				color: #999;
				position: absolute;
				top: 0;
				right: 0;
				display: inline-block;
			}
			
			.kai~label {
				background-color: #fff;
				border: 0.025rem solid #ddd;
				margin: 0.775rem 0;
				display: inline-block;
				position: relative;
				height: 1.4rem;
				width: 3rem;
				border-radius: 0.7rem;
			}
			
			.kai:checked~label {
				background: #32CEA0;
				border: 0.025rem solid #32CEA0;
			}
			
			.kai:checked~label .circle {
				left: 1.7rem;
			}
			
			.kai:checked~label .on {
				display: inline-block;
			}
			
			.kai:checked~label .off {
				display: none;
			}
			
			label .circle {
				display: inline-block;
				height: 1.3rem;
				width: 1.3rem;
				margin: 0.05rem 0;
				border-radius: 50%;
				box-shadow: 0 0.05rem 0.125rem rgba(0, 0, 0, .4);
				z-index: 10;
				background: #fff;
				position: absolute;
				left: 0;
				transition: all 0.3s;
				-webkit-transition: all 0.3s;
			}
			
			label .text {
				width: 50%;
				height: 100%;
				line-height: 1.4rem;
				font-size: 0.5rem;
				text-align: center;
			}
			/*开关按钮*/
			
			.hint,
			.hints {
				width: 80%;
				height: 7.5rem;
				background: rgba(255, 255, 255, 1);
				border-radius: 0.2rem;
				margin: 0 auto;
				position: fixed;
				top: 50%;
				left: 50%;
				background: #fff;
				z-index: 12;
				margin-left: -40%;
				margin-top: -3.75rem;
				display: none;
			}
			
			.mask {
				width: 100%;
				height: 100%;
				position: fixed;
				top: 0;
				left: 0;
				z-index: 11;
				background: rgba(0, 0, 0, 0.3);
				display: none;
			}
			
			.h_top {
				width: 100%;
				height: 4.35rem;
				text-align: center;
			}
			
			.h_top>img {
				width: 2.3rem;
				height: 2.25rem;
				margin-top: 1.2rem;
			}
			
			.h_fot {
				width: 100%;
				height: 3.15rem;
				line-height: 2rem;
				font-size: 0.8rem;
				color: #333;
				text-align: center;
			}
			
			.dele {
				width: 1.2rem;
				height: 1.2rem;
				position: absolute;
				top: 0.6rem;
				right: 0.6rem;
				cursor: pointer;
			}
			
			.dele>img {
				width: 100%;
				height: 100%;
			}
			
			.hs_top {
				width: 100%;
				height: 4rem;
				line-height: 3.5rem;
				font-size: 0.8rem;
				font-weight: 500;
				color: #333;
				text-align: center;
			}
			
			.hs_fot {
				width: 80%;
				height: 3.5rem;
				display: flex;
				margin: 0 auto;
			}
			
			.cancel {
				width: 45%;
				height: 2rem;
				line-height: 2rem;
				text-align: center;
				border: 0.05rem solid #C5C5C5;
				border-radius: 0.2rem;
				font-size: 0.8rem;
				color: #777;
			}
			
			.san {
				width: 45%;
				height: 2rem;
				line-height: 2rem;
				text-align: center;
				border: 0.05rem solid #FE5F5F;
				border-radius: 0.2rem;
				font-size: 0.8rem;
				color: #FE5F5F;
				margin-left: 10%;
			}
			
			.confirm {
				width: 100%;
				height: 2rem;
				background: #fff;
				padding: 0.2rem 0;
				z-index: 10;
			}
			
			.save {
				width: 90%;
				height: 2rem;
				margin: 0 auto;
				background: #32CEA0;
				font-size: 0.8rem;
				font-weight: 600;
				text-align: center;
				color: #fff;
				letter-spacing: 0.25rem;
				line-height: 2rem;
				border-radius: 0.2rem;
				cursor: pointer;
			}
			/*小图标*/
			
			.list {
				width: 100%;
				height: 100%;
				overflow: auto;
				position: fixed;
				top: 0;
				left: 0;
				background: rgba(119, 119, 119, 1);
				z-index: 1000;
				display: none;
			}
			
			.l_img {
				width: 16.66%;
				height: 3.3rem;
				text-align: center;
				float: left;
				cursor: pointer;
			}
			
			
			.l_img>img {
				width: 0.75rem;
				height: 0.75rem;
				margin: 1.225rem 0;
			}
			
			.model {
				position: fixed;
				bottom: 10rem;
				left: 50%;
				transform: translate(-50%, 0%);
				width: auto;
				height: 2.2rem;
				padding: 0 0.75rem;
				background: rgba(0, 0, 0, 0.5);
				color: #fff;
				font-size: 0.8rem;
				text-align: center;
				line-height: 2.2rem;
				border-radius: 0.26rem;
				white-space: nowrap;
				display: none;
			}
			.myclick{
				width: 20%;
				height: 100%;
				cursor: pointer;
				text-align: right;
				overflow: hidden;
			}
		</style>
	</head>

	<body>
		<div class="top">
			<div class="top_left">
				<div class="top_up">快速入口按钮</div>
				<div class="top_down">注：快速入口最多可添加四个</div>
			</div>
			<div class="add">
				<div class="a_cen">+</div>
			</div>
		</div>
		<div class="texts">

		</div>
		<div class="hint">
			<div class="h_top">
				<img src="__HOME_IMAGES__/newvnet/imgtxt/icon_address@2x.png" alt="" />
			</div>
			<div class="h_fot">快速入口最多可添加四个</div>
		</div>
		<div class="hints">
			<div class="hs_top"></div>
			<div class="hs_fot">
				<div class="cancel">取消</div>
				<div class="san" data-id="">删除</div>
			</div>
		</div>
		<div class="mask"></div>
		<div class="list">

		</div>
		<div class="model"></div>
		<script>
			//详情渲染
			var this_index = 1;
			var unionid = "{$unionid}";
			var lista = ""
			$.ajax({
				type: 'post',
				url: '/index.php?s=/Api/NewCardApi/quick_list',
				dataType: 'json',
				data: {
					unionid: unionid,
					type: 2
				},
				success: function(res) {
//					console.log(res);

					if(res.ResultType == 0) {
						$.each(res.AppendData, function(a, b) {
							lista += '<div class="txt" data-id="' + b.id + '">'
							lista += '<div class="txt_up">入口名称</div>'
							lista += '<div class="ipt">'
							lista += '<input type="text" class="tit" value="' + b.title + '" placeholder="名称最多为四个字" maxlength="4"/>'
							lista += '</div>'
							lista += '<div class="icon">'
							lista += '<a href="javascript:;">'
							lista += '<div class="i_left">选择图标</div>'
							//lista += '<div class="i_cen">'

							lista += '<div class="i_cen' + a + 1 + ' myclick"  data-index=' + a + 1 + '>'
							lista += '<div class="c_img" data-id="' + b.id + '">'
							lista += '<img class="c_icon' + a + 1 + '"  src="' + b.img + '" />'

							//lista += '<div class="c_img" data-id="">'
							//lista += '<img class="c_icon" src="' + b.img + '" alt="" />'
							lista += '</div>'
							lista += '</div>'
							lista += '<div class="i_right">'
							lista += '<img src="__HOME_IMAGES__/newvnet/vhome/shape2x.png" alt="" />'
							lista += '</div>'
							lista += '</a>'
							lista += '</div>'
							lista += '<div class="links">'
							lista += '<div class="links_up">输入链接</div>'
							lista += '<div class="links_ipt">'
							lista += '<div class="links_lian" contenteditable="true" value="" placeholder="请输入网址并在前面加上http://">' + b.url + '</div>'
							lista += '</div>'
							lista += '</div>'
							lista += '<div class="dele" data-id="' + b.id + '">'
							lista += '<img src="__HOME_IMAGES__/newvnet/apro/del.png" alt="" />'
							lista += '</div>'
							lista += '<div class="foot">'
							lista += '<div class="foot_left">是否在首页展示</div>'
							lista += '<div class="foot_right">'
							if(b.is_home==1){
								lista += '<input type="checkbox" id="radio' + a + 1 + '" checked class="kai" name="switch">'
							}else if(b.is_home==2){
								lista += '<input type="checkbox" id="radio' + a + 1 + '" class="kai" name="switch">'

							}
							lista += '<label for="radio' + a + 1 + '" class="radio">'
							lista += '<span class="circle"></span>'
							lista += '<span class="text on">ON</span>'
							lista += '<span class="text off">OFF</span>'
							lista += '</label>'
							lista += '</div>'
							lista += '</div>'
							lista += '<div class="confirm">'
							lista += '<div class="save">保存</div>'
							lista += '</div>'
							lista += '</div>'
							var is_home = b.is_home;
							if(is_home == 1) {
								$("#radio").attr("checked", "true");
							} else if(is_home == 2) {
								$("#radio").remove("checked")
							}
						})
						$(".texts").html(lista);
					}

				},
				error: function() {
					console.log("错误")
				}
			});

			//小图标
			var unionid = "{$unionid}";
			var listb = ""
			$.ajax({
				type: 'post',
				url: '/index.php?s=/Api/NewCardApi/quick_img',
				dataType: 'json',
				data: {
					unionid: unionid,
				},
				success: function(res) {
//					console.log(res)

					if(res.ResultType == 0) {
						$.each(res.AppendData, function(c, d) {
							listb += '<div class="l_img" data-id="' + d.id + '">'
							listb += '<img src="' + d.img + '" alt="" />'
							listb += '</div>'
						})
						$(".list").html(listb)
					}

				},
				error: function() {
					console.log("错误")
				}
			});
			var is_home="";
			$(document).on("click", ".save", function() {
				//添加
				var unionid = "{$unionid}";
				var q_id = $(this).parent().parent().attr("data-id");
				var tit = $(this).parent().parent().find(".tit").val();
				var i_id = $(this).parent().parent().find(".c_img").attr("data-id");
				var urls = $(this).parent().parent().find(".links_lian").html();
				
				if($(this).parent().parent().find(".kai").prop('checked')) {
					is_home = 1
				} else {
					is_home = 2
				}
//				console.log(q_id)
//				console.log(tit)
//				console.log(i_id)
//				console.log(urls)
//				console.log(is_home)

				if($(".tit").val() == "") {
					$(".model").show();
					setTimeout(function() {
						$(".model").hide();
					}, 1500)
					$(".model").html("请输入标题");
					return false;
				}

				if(i_id == "") {
					$(".model").show();
					setTimeout(function() {
						$(".model").hide();
					}, 1500)
					$(".model").html("请选择图标");
					return false;
				}

				if(urls == "") {
					$(".model").show();
					setTimeout(function() {
						$(".model").hide();
					}, 1500)
					$(".model").html("请输入链接");
					return false;
				}

				var listc = ""
				$.ajax({
					type: 'post',
					url: '/index.php?s=/Api/NewCardApi/add_quick',
					dataType: 'json',
					data: {
						unionid: unionid,
						quick_id: q_id,
						title: tit,
						quick_img_id: i_id,
						url: urls,
						is_home: is_home
					},
					success: function(res) {
//						console.log(res);
						if(res.ResultType == 0) {
							$(".model").show();
							setTimeout(function() {
								$(".model").hide();
							}, 1500)
							$(".model").html("保存成功");
							setTimeout(function() {
								window.location.reload();
							}, 1600)

						}

					},
					error: function() {
						console.log("错误")
					}
				});

			})
			var num = $(".txt").length
			$(".add").on("click", function() {
				var num = $(".txt").length;
				num++;
				if($(".txt").length >= 4) {
					$('.mask').show();
					$(".hint").show();
					setTimeout(function() {
						$('.hint').hide();
						$('.mask').hide();
					}, 1500);
					return false;
				}
				$(".texts").append(
					'<div class="txt" data-id="">' +
					'<div class="txt_up">入口名称</div>' +
					'<div class="ipt">' +
					'<input type="text" class="tit" placeholder="名称最多为四个字" maxlength="4" />' +
					'</div>' +
					'<div class="icon">' +
					'<a href="javascript:;">' +
					'<div class="i_left">选择图标</div>' +
					'<div class="i_cen' + num + ' myclick"  data-index=' + num + '>' +
					'<div class="c_img" data-id="">' +
					'<img class="c_icon' + num + '" src="" alt="" />' +
					'</div>' +
					'</div>' +
					'<div class="i_right">' +
					'<img src="__HOME_IMAGES__/newvnet/vhome/shape2x.png" alt="" />' +
					'</div>' +
					'</a>' +
					'</div>' +
					'<div class="links">' +
					'<div class="links_up">输入链接</div>' +
					'<div class="links_ipt">' +
					'<div class="links_lian" contenteditable="true" placeholder="请输入网址并在前面加上http://"></div>' +
					'</div>' +
					'</div>' +
					'<div class="dele" data-id="">' +
					'<img src="__HOME_IMAGES__/newvnet/apro/del.png" alt="" />' +
					'</div>' +
					'<div class="foot">' +
					'<div class="foot_left">是否在首页展示</div>' +
					'<div class="foot_right">' +
					'<input type="checkbox" id="radio' + num + '" class="kai"  name="switch">' +
					'<label for="radio' + num + '" class="radio' + num + '">' +
					'<span class="circle"></span>' +
					'<span class="text on">ON</span>' +
					'<span class="text off">OFF</span>' +
					'</label>' +
					'</div>' +
					'</div>' +
					'<div class="confirm">' +
					'<div class="save">保存</div>' +
					'</div>' +
					'</div>'
				)

			})
			$(document).on("click", ".myclick", function() {
				$(".list").show();
				this_index = $(this).attr("data-index");
			})
			$(document).on("click", ".l_img", function() {
				$(".list").hide();
				var src = $(this).find("img").attr("src");
				//console.log($(this).find("img").attr("src"))
				var listss = $(".myclick");
				for(var a in listss) {
					if($(listss[a]).attr("data-index") == this_index) {
						$(listss[a]).find("img").attr("src", src);
						$(listss[a]).find("div.c_img").attr("data-id", $(this).attr("data-id"));
						break;
					}

				}

			})

			$(document).on("click", ".dele", function() {
				//				$(this).parent().hide();
				$(".mask").show();
				$(".hints").show();
				$(".san").attr("data-id", $(this).attr("data-id"))
				$(".hs_top").html("删除<"+$(this).parent().find(".tit").val()+">入口")
			})

			$(".san").on("click", function() {
				var p_id = $(this).attr("data-id");
				var elelist = $("div.txt div.dele");
				for(var a in elelist) {
					//					console.log($(elelist[a]).attr("data-id"))
					if($(elelist[a]).attr("data-id") == p_id) {
						$(elelist[a]).parent().remove();
						break;
					}
				}
//				console.log(p_id)
				$.ajax({
					type: 'post',
					url: 'index.php?s=/Api/NewCardApi/del_quick',
					dataType: 'json',
					data: {
						unionid: unionid,
						quick_id: p_id

					},
					success: function(res) {
//						console.log(res);
						$(".mask").hide();
						$(".hints").hide();
						window.location.reload();
					},
					error: function() {
						console.log("错误")
					}
				});
			})

			$(".cancel").on("click", function() {
				$(".mask").hide();
				$(".hints").hide();
			})
		</script>
		<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
		<script type="text/javascript">
			document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
				// 通过下面这个API隐藏右上角按钮hideOptionMenu
				WeixinJSBridge.call('hideOptionMenu');
			});
		</script>
	</body>

</html>