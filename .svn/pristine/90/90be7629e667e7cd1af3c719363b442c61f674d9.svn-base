<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="/Public/Home/js/whjs/js/jquery-3.2.1.js"></script>
    <script src="/Public/Home/js/whjs/js/newrem.js"></script>
    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/swiper.min.css">
    <title>链接一切</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,body {
            background: #eee
        }

        .content {
            width: 100%;
        }

        .jia {
            width: 90%;
            height: .4rem;
            margin: 24px 20px;
            background: #F8C85E;
            border-radius: .04rem;
        }

        .ziti {
            color: #fff;
            font-size: .16rem;
            text-align: center;
            display: block;
            line-height: .4rem;
            font-family: PingFangSC-Semibold;
            font-weight: 600;
        }

        .moren {
            width: 90%;
            height: 1.04rem;
            margin: .08rem auto;
            background: #fff;
            position: relative;
            box-shadow: 0px 2px 10px 0px rgba(191, 191, 191, 0.25);
            display: block;
            color: #333333;
        }

        .leftop {
            width: .5rem;
            height: .18rem;
            top: .16rem;
            position: absolute;
        }

        .leftopp {
            width: .5rem;
            height: .18rem;
            top: .16rem;
            position: absolute;
        }

        .titlem {
            width: 2.2rem;
            height: .22rem;
            left: .5rem;
            top: .41rem;
            text-align: center;
            position: absolute;
            /* background: palevioletred; */
            font-size: 16px;
            font-family: PingFangSC-Semibold;
            font-weight: 600;
            line-height: .22rem;
        }

        .titlemr {
            width: 2.2rem;
            height: .22rem;
            left: .5rem;
            top: .26rem;
            text-align: center;
            position: absolute;
            font-size: 16px;
            font-family: PingFangSC-Semibold;
            font-weight: 600;
            line-height: .22rem;
        }

        .xiugai {
            width: .32rem;
            height: .32rem;
            right: .16rem;
            top: .16rem;
            border-radius: 50%;
            background: #fff;
            position: absolute;
        }

        .shanchu {
            width: .32rem;
            height: .32rem;
            right: .16rem;
            border-radius: 50%;
            background: #fff;
            position: absolute;
            bottom: .16rem;
        }

        .shancu {
            width: .32rem;
            height: .32rem;
            right: .16rem;
            border-radius: 50%;
            background: #fff;
            position: absolute;
            bottom: .16rem;
        }

        .delzz {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 9;
        }

        .deltk {
            width: 3.11rem;
            height: 1.5rem;
            background: #fff;
            margin: 0 auto;
            margin-top: 60%;
            border-radius: .04rem;
        }

        .tkzz {
        	height:0.52rem;
            font-size: 16px;
            font-family: PingFangSC-Medium;
            font-weight: 550;
            color: #333;
            display: block;
            text-align: center;
            line-height: .7rem;
        }
        
        .note {
		    width: 100%;
		    height: 0.2rem;
		    line-height: 0.2rem;
		    font-size: 0.12rem;
		    color: #FE5F5F;
		    text-align: center;
		}

        ul li {
            list-style: none;
        }

        .delsc {
            font-size: 16px;
            font-family: PingFangSC-Regular;
            font-weight: 400;
            float: left;
            margin-left: 7%;
            margin-top: 5%;
            width: 1.2rem;
            height: .4rem;
            text-align: center;
            line-height: .4rem;
            border: 1px solid #FE5F5F;
            color: #FE5F5F;
            border-radius: .04rem;
        }

        .delqx {
            font-size: 16px;
            font-family: PingFangSC-Regular;
            font-weight: 400;
            float: left;
            margin-left: 7%;
            margin-top: 5%;
            width: 1.2rem;
            height: .4rem;
            text-align: center;
            line-height: .4rem;
            color: #777;
            border: 1px solid #c5c5c5;
            border-radius: .04rem;
        }

        .zdytop {
            width: 100%;
            height: .16rem;
        }

        .titleinp {
            width: 1.5rem;
            height: .22rem;
            left: .5rem;
            top: .3rem;
            position: absolute;
            font-size: .14rem;
            font-family: PingFangSC-Semibold;
            font-weight: 600;
            border: none;
            outline: none;
        }

        input:focus {
            color: #32CEA0;
        }

        .xiurjl {
            width: 2.7rem;
            height: .8rem;
            left: .6rem;
            top: .1rem;
            z-index: 2;
            position: absolute;
            background: #FFF;
            display: none;
        }

        .xiurjlx {
            width: 2.7rem;
            height: .8rem;
            left: .6rem;
            top: .1rem;
            z-index: 2;
            position: absolute;
            background: #FFF;
            display: block;
        }

        .rxiurjlx {
            width: 2.7rem;
            height: .8rem;
            left: .6rem;
            top: .1rem;
            z-index: 2;
            position: absolute;
            background: #FFF;
        }

        .surerjl {
            width: .44rem;
            height: .44rem;
            background: #32CEA0;
            border-radius: 50%;
            font-size: 12px;
            font-family: PingFangSC-Medium;
            font-weight: 500;
            color: rgba(255, 255, 255, 1);
            line-height: .45rem;
            position: absolute;
            right: .16rem;
            top: .2rem;
            display: block;
            text-align: center;
        }

        .ssurerjl {
            width: .44rem;
            height: .44rem;
            background: #32CEA0;
            border-radius: 50%;
            font-size: 12px;
            font-family: PingFangSC-Medium;
            font-weight: 500;
            color: rgba(255, 255, 255, 1);
            line-height: .45rem;
            position: absolute;
            right: .16rem;
            top: .2rem;
            display: block;
            text-align: center;
            /* display: none; */
        }

        .rsurerjl {
            width: .44rem;
            height: .44rem;
            background: #32CEA0;
            border-radius: 50%;
            font-size: 12px;
            font-family: PingFangSC-Medium;
            font-weight: 500;
            color: rgba(255, 255, 255, 1);
            line-height: .45rem;
            position: absolute;
            right: .16rem;
            top: .2rem;
            display: block;
            text-align: center;
        }

        .sdpx {
            width: 1rem;
            height: 0.5rem;
            font-size: .12rem;
            font-family: PingFangSC-Regular;
            font-weight: 400;
            color: rgba(119, 119, 119, 1);
            line-height: .05rem;
            right: 1.56rem;
            position: fixed;
            text-align: center;
            display: none;
            bottom: 0;
            z-index: 20;
        }

        .sdpx a {
            font-size: .12rem;
            font-family: PingFangSC-Regular;
            font-weight: 400;
            color: rgba(119, 119, 119, 1);
            line-height: .05rem;
            list-style: none;
            text-decoration: none
        }

        .sdpx img {
            width: .11rem;
            height: .15rem;
            background-size: 100% 100%;
        }

        .xiugai img {
            position: absolute;
            width: .32rem;
            height: .32rem;
            background-size: 100% 100%;
        }

        .shanchu img {
            position: absolute;
            width: .32rem;
            height: .32rem;
            background-size: 100% 100%;
        }

        .shancu img {
            position: absolute;
            width: .32rem;
            height: .32rem;
            background-size: 100% 100%;
        }

        .leftop img {
            position: absolute;
            width: .5rem;
            height: .18rem;
            background: 100% 100%;
        }

        .leftopp img {
            width: .5rem;
            height: .18rem;
            position: absolute;
            background: 100% 100%;
        }

        .leftzzzt {
            width: 100%;
            /* width: .25rem; */
            height: .16rem;
            font-size: .11rem;
            font-family: PingFangSC-Regular;
            font-weight: 400;
            color: rgba(255, 255, 255, 1);
            line-height: .18rem;
            position: absolute;
            text-align: center;
        }

        .leftdt {
            height: .16rem;
            font-size: .11rem;
            font-family: PingFangSC-Regular;
            font-weight: 400;
            color: rgba(255, 255, 255, 1);
            line-height: .18rem;
            position: absolute;
            left: .06rem;
        }

        /* 最多4个 */

        .tip_mssg {
            background: #fff;
            position: fixed;
            top: 50%;
            left: 50%;
            margin-top: -0.57rem;
            margin-left: -1.24rem;
            border-radius: .1rem;
            text-align: center;
            z-index: 1001;
        }

        .tip_mssg p:nth-child(1) {
            font-size: .16rem;
            padding: .1rem 1.06rem;
        }

        .tip_mssg p:nth-child(2) {
            font-size: .12rem;
            padding: 0 .52rem .215rem .52rem;
        }

        .tip_mssg .check {
            width: 100%;
            border-top: 1px solid #979797;
        }

        .tip_mssg .check .cancel {
            border-right: 1px solid #979797;
            color: #666666;
        }

        .tip_mssg .check .confrirm {
            color: #34B1D3;
        }

        .tip_mssg .check .cancel,
        .confrirm {
            padding: .1rem .525rem .1rem .465rem;
            font-size: .15rem;
        }

        .mask {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            position: fixed;
            left: 0;
            top: 0;
            z-index: 998;
            display: none;
        }

        a:active{
             -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        .tips{
            width: 2rem;
            padding: .05rem 0;
            color: #fff;
            text-align: center;
            position: fixed;
            bottom: .3rem;
            left: 50%;
            margin-left: -1rem;
            background: rgba(0, 0, 0, 0.7);
            font-size: .15rem;
            border-radius: .04rem;
            display: none;
        }

        .zdytj{
            width: 100%;
            height: .3rem;
            position: relative;
            margin-top: .1rem;
        }

         .zdytj a{
             display: block;
             width: 1rem;
             height: .24rem;
             line-height: .24rem;
             font-size: .14rem;
             text-decoration: none;
             position: absolute;
             left: 50%;
             margin-left: -0.5rem;
             color: #777777;
             text-align: center;
         }

          .zdytj a img{
              widows: .12rem;
              height: .15rem;
          }

          .delss{
              width: .2rem;
              height: .2rem;
              position: absolute;
              top: .05rem;
              right: .05rem;
              z-index: 11;
          }
          .zdy_check{
            width: .44rem;
            height: .44rem;
            background: #32CEA0;
            border-radius: 50%;
            font-size: 12px;
            font-family: PingFangSC-Medium;
            font-weight: 500;
            color: rgba(255, 255, 255, 1);
            line-height: .45rem;
            position: absolute;
            right: .16rem;
            top: .2rem;
            display: block;
            text-align: center;
          }
    </style>
</head>

<body>
    <div class="content">
        <div class="jia">
            <span class="ziti">+ 添加自定义栏目</span>
        </div>
    <div class="moren_box">
         
    </div>
    <!-- 手动排序 -->
    <div class="zdytj">
            <a href="/index.php?s=/Home/vlink/compositor.html">
                <img src="Public/Home/images/vwzz/icon_paixu.png" alt=""> 手动排序
            </a>
    </div>

        <div class="mask">
            <div class="tip_mssg">
                <p>提示</p>
                <p class="text">最多添加4个！</p>
                <div class="clearfix check">
                    <div class="fl confrirm">确定</div>
                </div>
            </div>
        </div>
        <!-- 遮罩层 -->
        <div class="delzz">
            <div class="deltk">
                <span class="tkzz"></span>
                <div class="note">注：栏目里的内容会同时被删除</div>
                <ul class="anniu">
                    <li class="delqx">取消</li>
                    <li class="delsc">删除</li>
                </ul>
            </div>
        </div>
    </div>
    <!-- 提示语 -->
    <div class="tips">删除成功</div>
</body>

<script>
   $(function(){

        var unionid = '{$unionid}';
        //点击添加自定义
 
        $.ajax({  //链接一切分类查询
            url: "/index.php?s=/Api/NewCardApi/user_nav_type",
            type: 'post',
            data: {
                unionid: unionid,
            },
            success: function (res) {
                console.log(res)
                // console.log(res+'---->分类查询');
                

                var detail = res.AppendData;
                if(detail.length == 0) {
                    $('.zdytj').hide()
                }else{
                    $('.zdytj').show()
                }
                var list = '';
                $.each(detail, function (k, v) {
                    // list+= '<a class="moren" href="/index.php?s=/Home/vlink/addvlink.html&typeid='+v.id+'">'
                    list+= '<a class="moren" href="/index.php?s=/Home/vlink/linkdisplay.html&typeid='+v.id+'&title='+v.title+'">'
                    list+= '<div class="leftop">'
                    if(k == 0){
                        list+= '<img src="Public/Home/images/vwzz/lable_mo.png" alt="">'
                        list+= '<span class="leftzzzt">默认</span>'
                    }else{
                        list+= '<img src="Public/Home/images/vwzz/lable_zidingyi.png" alt="">'
                        list+= '<span class="leftzzzt">自定义</span>'
                    }
                    list+= '</div>'
                    list+='<div class="titlem">'+v.title+'</div>'
                    list+= '<div class="xiurjl">'
                    list+='<input class="titleinp" placeholder="最多输入6个字" maxlength="6" id="shuru">'
                    list+= '<div class="surerjl" data-edit="'+v.id+'" >确定</div>'
                    list+= '</div>'
                    list+='<div class="xiugai">'
                    list+= '<img src="Public/Home/images/vwzz/icon_lian_bi.png" alt="">'
                    list+= '</div>'
                    list+='<div class="shanchu" data-del="'+v.id+'" >'
                    list+='<img src="Public/Home/images/vwzz/icon_lian_de.png" alt="">'
                    list+='</div>'
                    list+='</a>'
                })
                $(".moren_box").html(list)
            },
        })

        //修改编辑分类
        var edit_text;
        $('.moren_box').on('click','.xiugai',function(event){
            console.log('修改11111')
            event.stopPropagation();
            event.preventDefault();
            $(this).prev().show();
            edit_text = $(this).prev().prev().text()
            $(this).prev().find('.titleinp').val(edit_text);

            $(this).prev().find('input').trigger("click").focus();

        })
        $('.moren_box').on('click','.titleinp',function(event){
            event.stopPropagation();
            event.preventDefault();
        })
        $('.moren_box').on('click','.surerjl',function(event){
            event.stopPropagation();
            event.preventDefault();
            var edit_title = $(this).prev().val();
            if(edit_title == ''){
                $('.tips').text('请输入分类标题').stop(true).fadeIn(500).fadeOut(1500);
                return false;
            }
            var edit_id =  $(this).attr('data-edit');
            var that = $(this);
            $.ajax({
                url:'index.php?s=/Api/NewCardApi/add_user_nav_type',
                type:'post',
                data:{
                     unionid: unionid,
                     title:edit_title,
                     type_id:edit_id
                },
                success:function(res){
                    that.parent().hide();
                    that.parent().prev().text(edit_title);

                },
                error:function(){
                    that.parent().hide();
                    console.log('走了错误')
                }
            })

            
    })
        // 删除分类
        var that;
        var del_id;
        $('.moren_box').on('click','.shanchu',function(event){
            event.stopPropagation();
            event.preventDefault();
            del_id = $(this).attr('data-del');
            that = $(this);
            var lanmu = $(this).prev().prev().prev().text()
            console.log(lanmu)
            $('.delzz').show().find('.tkzz').text('删除<'+lanmu+'>栏目');
        })
        // 确认删除分类
        $('.delzz').on('click','.delsc',function(){
            console.log(del_id)
               $.ajax({
                type:'post',
                url:'/index.php?s=/Api/NewCardApi/user_nav_del_type',
                data:{
                    unionid:unionid,
                    type_ids:del_id
                },
                success:function(res){
                    console.log(res)
                    if(res.ResultType == 0){
                        $('.tips').text('删除成功').stop(true).fadeIn(500).fadeOut(1500);
                        $('.delzz').hide();
                        that.parent().remove();

                        if($('.moren_box .moren').length == 0) {
                            $('.zdytj').hide()
                        }else{
                            $('.zdytj').show()
                        }
                    }
                },
                error:function(res){
                     $('.tips').text(res).stop(true).fadeIn(500).fadeOut(1500);
                    console.log('走了错误，删除失败')
                }
            })
        })
        //取消删除
        $('.delzz').on('click','.delqx',function(){
            $('.delzz').hide()
        })
        //添加自定义模板
        $('.content').on("click", ".jia", function () {
            custom = 1;
            if ($(".moren").length >= 4) {
                $(".mask").fadeIn(500).find(".text").text("最多添加4个！");
                return false;
            } else {
                var template = '';
                template+= '<a class="moren" href="javascript:;">'
                template+= '<img class="delss" src="/Public/Home/images/wh/make_icon_close@2x.png" alt="">'
                template+= '<div class="leftop">'
                template+= '<img src="Public/Home/images/vwzz/lable_zidingyi.png" alt="">'
                template+= '<span class="leftzzzt">自定义</span>'
                template+= '</div>'
                template+='<div class="titlem"></div>'
                template+= '<div class="xiurjl" style="display: block;">'
                template+='<input class="titleinp add_model" autofocus="autofocus"  placeholder="最多输入6个字" maxlength="6" id="shuru">'
                template+= '<div class="zdy_check" >确定</div>'
                template+= '</div>'
                template+='<div class="xiugai">'
                template+= '<img src="Public/Home/images/vwzz/icon_lian_bi.png" alt="">'
                template+= '</div>'
                template+='<div class="shanchu" >'
                template+='<img src="Public/Home/images/vwzz/icon_lian_de.png" alt="">'
                template+='</div>'
                template+='</a>'
                $('.moren_box').append(template);
                $('.add_model').trigger("click").focus();
            }
        });
        //添加自定义模板
        $('.moren_box').on('click','.zdy_check',function(event){
                event.stopPropagation();
                event.preventDefault();
                var text = $(this).prev().val();
                var thta_ = $(this);
                if(text == ''){
                     $('.tips').text('请输入分类标题').stop(true).fadeIn(500).fadeOut(1500);
                     return false;
                }
                $.ajax({
                    type:'post',
                    url:'/index.php?s=/Api/NewCardApi/add_user_nav_type',
                    data:{
                        unionid:unionid,
                        title:text
                    },
                    success:function(res){
                        console.log(res)
                        thta_.parents('.moren').remove();
                        var data = res.AppendData;
                        var list = ''
                        list+= '<a class="moren" href="/index.php?s=/Home/vlink/linkdisplay.html&typeid='+data+'&title='+text+'">'
                        list+= '<div class="leftop">'
                        list+= '<img src="Public/Home/images/vwzz/lable_zidingyi.png" alt="">'
                        list+= '<span class="leftzzzt">自定义</span>'
                        list+= '</div>'
                        list+='<div class="titlem">'+text+'</div>'
                        list+= '<div class="xiurjl">'
                        list+='<input class="titleinp" placeholder="最多输入6个字" maxlength="6" id="shuru">'
                        list+= '<div class="surerjl" data-edit="'+data+'">确定</div>'
                        list+= '</div>'
                        list+='<div class="xiugai">'
                        list+= '<img src="Public/Home/images/vwzz/icon_lian_bi.png" alt="">'
                        list+= '</div>'
                        list+='<div class="shanchu" data-del="'+data+'">'
                        list+='<img src="Public/Home/images/vwzz/icon_lian_de.png" alt="">'
                        list+='</div>'
                        list+='</a>'
                        
                        $('.moren_box').append(list);
                        $('.zdytj').show()
                    }
                })

        })
        // 删除自定义模板
        $('.moren_box').on('click','.delss',function(event){
            event.stopPropagation();
            event.preventDefault();
            $(this).parent().remove();
        })
    

  

    $('.anniu').on('click', '.delqx', function () {
        $('.delzz').hide();
    })
    //点击修改弹出输入框
    $('.moren').on('click', '.xiugai', function (e) {
        e.cancelBubble = true;
        e.stopPropagation();
        $(this).prev().show();
    })


    //点击确定自定义消失
    $(document).on('click', '.rsurerjl', function (e) {

        console.log(222222222221);

        e.cancelBubble = true;
        e.stopPropagation();
        $('.rxiurjlx').hide();
        $(".titlemr").html($(this).prev().val())


        var text = $(this).parent().prev().text();
        console.log(text);
        // return;

        $.ajax({
            url: "index.php?s=/Api/NewCardApi/add_user_nav_type",
            type: 'post',
            data: {
                unionid: user_id,
                title: text,
                type_id: '',
            },
            success: function (res) {
                console.log(res);
            },
            error: function () {

            }
        })



    })
    // 点击确定提示关闭
    $('.clearfix').on('click', '.confrirm', function () {
        $('.mask').hide();

    })


});
</script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
<script type="text/javascript">
	document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
		// 通过下面这个API隐藏右上角按钮hideOptionMenu
		WeixinJSBridge.call('hideOptionMenu');
	});
</script>

</html>