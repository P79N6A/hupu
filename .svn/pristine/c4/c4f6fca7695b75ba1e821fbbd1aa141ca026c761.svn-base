<extend name="./base" />

<block name="css_extend">
	<link href="__HOME_CSS__/bs3/dpl.css" rel="stylesheet" />
	<link href="__HOME_CSS__/bs3/bui.css" rel="stylesheet" />
	<script src="__HOME_CSS__/bs3/sea.js"></script>
	<script src="https://g.alicdn.com/bui/bui/1.1.21/config.js"></script>
	<style>
		.zhuaqu .textarea {
			min-height: 150px;
			border: 0 !important;
			outline: none !important;
		}

		html,body{
			width: 100%;
			height: 100%;
		}
		
		.title {
			color: #6d6d6d;
			font-size: 15px;
			margin-bottom: 14px !important;
		}
		
		.zhuaqu {

			position: relative;
			border: none !important;
		}
		
		.fun {
			position: absolute;
			bottom: 30px;
			right: 0;
		}
		
		.empty {
			width: 55px;
			height: 24px;
			line-height: 24px;
			background-color: #979797;
			border-radius: 12px;
			padding: 0 !important;
			color: #fff;
			border: none;
			margin-right: 15px;
		}
		
		.paste {
			width: 55px;
			height: 24px;
			line-height: 24px;
			background-color: #2FB3D3;
			border-radius: 12px;
			padding: 0 !important;
			color: #fff;
			border: none;
			margin-right: 15px;
			cursor: pointer;
		}
		
		.saves {
			width: 90%;
			margin: 0 auto;
			height: 44px;
			border-radius: 22px;
			margin-top: 27px;
			box-shadow: 0 5px 5px rgba(47, 179, 211, 0.3);
		}
		
		.save {
			width: 100%;
			height: 100%;
			border: none !important;
			background-color: #2FB3D3 !important;
			border-radius: 22px !important;
			color: #fff !important;
			font-size: 15px;
		}
		
		.zhuaqu_bottom {
			margin-top: 9px;
			padding: 0 !important;
		}
		
		.foot_top {
			overflow: hidden;
			width: 70%;
			margin: 0 auto;
			height: 40px;
			padding: 10px 0;
			margin-top: 10px;
		}
		
		.foot_top div {
			float: left;
			text-align: center;
		}
		
		.ft_border {
			width: 30%;
			height: 2px;
			background-color: #C5C5C5;
			text-align: center;
		}
		
		.do_zq {
			margin-top: -10px;
			width: 40%;
			font-size: 14px;
			color: #6D6D6D;
		}
		
		.bot-btm {
			width: 80%;
			margin: 0 auto;
			height: 55px;
		}
		
		.bot-btm div {
			float: left;
			width: 50%;
			height: 55px;
			text-align: center;
		}
		
		.bot-btm div>a {
			display: block;
			width: 100%;
			height: 100%;
		}
		
		.bot-btm div>a>img {
			width: 55px;
			height: 55px;
		}

		.mask{
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			position: fixed;
			background: rgba(0, 0, 0, .5);
			z-index: 332;
			display: none;
		}

		.mask .tips_box{
			width: 300px;
			height: 300px;
			position: absolute;
			top: 50%;
			left: 50%;
			margin-left: -150px;
			margin-top: -150px;
		}

		.mask .tips_box img{
			display: block;
			width: 50px;
			height: 50px;
			margin: 0 auto;
			margin-top: 30%;
		}

		.mask .tips_box p{
			text-align: center;
			color: #fff;
			margin-top: 5%;
		}
	</style>
</block>

<block name="body">

	<body>
		<div class="mui-content zzc_magrin_bottom">
			<div class="zhuaqu">
				<div class="title">请将文章链接URL粘贴到输入框：</div>
				<textarea class="textarea" name="url" id="url" rows="10" cols="10" placeholder="iphone版微信只需要轻点输入框左上侧就能出现粘贴选项，安卓版微信则可能需要长按输入框来粘贴">&nbsp;</textarea>
				<div class="fun">
					<button class="empty" onclick="empty()">清空</button>
					<!--<button class="paste">粘贴</button>-->
				</div>
			</div>
			<div class="saves">
				<input type="button" name="抓取" value="抓取" class="save" onclick="sumit_click()" />
			</div>
			<input type="hidden" value="{$id}" id="artid" />
			<div class="zhuaqu_bottom">
				<br/> 1、目前支持
				<a href='http://weixin.sogou.com/?token=1223223222'>微信文章</a>、
				<a href='https://www.toutiao.com/'>今日头条</a>文章抓取<br/> 2、用户需遵循
				<a href="http://weixin.qq.com/cgi-bin/readtemplate?t=weixin_external_links_content_management_specification">《微信外部链接内容管理规范》</a><br/><br/>

				<!--<div style=""><a href="http://weixin.sogou.com/">更多文章来源</a></div>-->
			</div>
			<div class="foot_top">
				<div class="ft_border"></div>
				<div class="do_zq">点击抓取</div>
				<div class="ft_border"></div>
			</div>
			<div class="bot-btm">
				<div>
					<a href="http://weixin.sogou.com/?token=1223223222">
						<img src="__HOME_IMAGES__/Group 4.png" alt="" />
					</a>
				</div>
				<div>
					<a href="https://www.toutiao.com/">
						<img src="__HOME_IMAGES__/Group 5.png" alt="" />
					</a>
				</div>
			</div>
			
		</div>
		<div class="mask">
			<div class="tips_box">
				<img src="/Public/Home/images/loadad.gif" alt="正在加载中">
				<p>文章抓取中请稍后</p>
			</div>
		</div>

	</body>
</block>

<block name="js_extend">

	<script>
		// console.log(123123)
		// var str = ' 123 ';
		// console.log(str)
		// console.log(str.trim())
		$(function() {
			var id = $("#artid").val();
			if(id) {
				var url = 'http://wx.yxm360.com/index.php?s=/Home/Article/previewArticle/is_home/1/id/' + id + '';
				$("#url").val(url);
			}

		})

		function empty() {
			$("#url").val(' ');
		}

		function sumit_click() {

			var _url = $("#url").val().trim(); //要抓取的文章URL
			if(_url.length <= 0) {
				mui.toast("请填写url");
				return;
			}
			BUI.use('bui/overlay', function(overlay) {
				BUI.Message.Show({
					title: '提示',
					msg: '是否前往抓取，部分文章有可能抓取失败？',
					icon: 'question',
					buttons: [{
							text: '取消',
							elCls: 'button',
							handler: function() {
								this.close();
							}
						},
						{
							text: '确定',
							elCls: 'button button-primary',
							handler: function() {
 
								// $.post("{:U('Home/Article/catchArticle')}", {
								// 	"url": _url
								// }, function(res) {
								// 	// console.log(res.id);return ;
								// 	if(res.status == 1) {
								// 		mui.toast(res.msg);
								// 		console.log(res.msg)
								// 		setTimeout(function() {
								// 			top.location.href = "/Home/Article/addArticle?id=" + res.id;
								// 			 top.location.href="http://192.168.100.41/index.php?s=/Home/Article/addArticle/id/"+res.id;
								// 		}, 500);
								// 	} else {
								// 		mui.toast(res.msg);
								// 	}
								// }); 

								$.ajax({
									type:"post",
									url:"{:U('Home/Article/catchArticle')}",
									data:{
										url: _url
									},
									beforeSend:function(){
										$(".mask").show();
									},
									success:function(res){
										if(res.status == 1){
											$(".mask").hide();
											mui.toast(res.msg);
											console.log(res)
											setTimeout(function () {
//											top.location.href = "/Home/Article/addArticle?id=" + res.id;


											top.location.href="__ROOT__/index.php?s=//Home/Article/addArticle/id/"+ res.id;



                                            }, 500);

										}else{
											mui.toast(res.msg);
											$(".mask").hide();
										}
									}
								});
								this.close();
							}
						}
					]
				});
			});
		}
	</script>
	<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
	<script type="text/javascript">
		document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
			// 通过下面这个API隐藏右上角按钮hideOptionMenu
			WeixinJSBridge.call('hideOptionMenu');
		});
	</script>

</block>